{"version":3,"file":"rai-sdk-javascript.umd.js","sources":["../../src/types.ts","../../src/rest.ts","../../src/base.ts","../../src/database/databaseApi.ts","../../src/transaction/transactionUtils.ts","../../src/transaction/types.ts","../../src/transaction/transactionApi.ts","../../src/edb/edbApi.ts","../../src/engine/types.ts","../../src/engine/engineApi.ts","../../src/model/modelApi.ts","../../src/oauthClient/oauthClientApi.ts","../../src/model/modelUtils.ts","../../src/query/queryUtils.ts","../../src/query/queryApi.ts","../../src/user/types.ts","../../src/user/userApi.ts","../../src/utils.ts","../../src/client.ts","../../src/credentials.ts","../../src/config.ts","../../src/database/types.ts","../../src/oauthClient/types.ts"],"sourcesContent":["/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Credentials } from './credentials';\n\nexport const VERSION =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof __RAI_SDK_VERSION__ === 'undefined'\n    ? 'to-be-replaced'\n    : // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      __RAI_SDK_VERSION__; // replaced at build time\n\nexport type Config = {\n  host: string;\n  port: string;\n  scheme: string;\n  credentials: Credentials;\n};\n\nexport interface AccessTokenCache {\n  access_token: string;\n  expires_in: number;\n  created_on: number;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport fetch, { Response } from 'cross-fetch';\nimport { stringify } from 'query-string';\n\nimport { Problem } from './transaction/types';\nimport { VERSION } from './types';\n\nconst isNode =\n  typeof process !== 'undefined' &&\n  process.versions != null &&\n  process.versions.node != null;\n\nexport type RequestOptions = {\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  headers?: Record<string, string>;\n  body?: any;\n  query?: Record<string, any>;\n  onResponse?: (r: Response) => void;\n};\n\nfunction addDefaultHeaders(headers: RequestInit['headers'], url: string) {\n  const sdkUserAgent = `rai-sdk-javascript/${VERSION}`;\n  const defaultHeaders: RequestInit['headers'] = {\n    Accept: 'application/json',\n    'Content-type': 'application/json',\n  };\n\n  if (isNode) {\n    // Only in Node because Browsers won't allow to set\n    const parsedUrl = new URL(url);\n\n    defaultHeaders['Host'] = parsedUrl.hostname;\n    defaultHeaders['User-agent'] = sdkUserAgent;\n  }\n\n  return { ...defaultHeaders, ...headers };\n}\n\nexport function makeUrl(scheme: string, host: string, port: string) {\n  scheme = scheme.replace(/[^A-Za-z]/, '');\n\n  return `${scheme}://${host}${port ? ':' + port : ''}`;\n}\n\nexport class SdkError extends Error {\n  status: string;\n  message: string;\n  details?: string;\n  problems?: Problem[];\n  response: Response;\n\n  constructor(body: any, response: Response) {\n    super('');\n\n    this.name = 'SdkError';\n    this.status = response.statusText;\n    this.response = response;\n\n    if (body.message !== undefined) {\n      this.message = body.message;\n      this.details = body.details;\n      this.status = body.status;\n    } else if (body.problems !== undefined) {\n      this.message = 'Database error. See problems.';\n      this.problems = body.problems;\n    } else {\n      this.message = 'Unknown error occured';\n    }\n  }\n\n  toString() {\n    return `${this.response.status} ${this.status}: ${this.message} ${\n      this.details || ''\n    }`;\n  }\n}\n\nexport async function request<T>(url: string, options: RequestOptions = {}) {\n  const opts = {\n    method: options.method || 'GET',\n    body: JSON.stringify(options.body),\n    headers: addDefaultHeaders(options.headers, url),\n  };\n  const fullUrl =\n    options.query && Object.keys(options.query).length > 0\n      ? `${url}?${stringify(options.query, { arrayFormat: 'none' })}`\n      : url;\n\n  const response = await fetch(fullUrl, opts);\n  const contentType = response.headers.get('content-type');\n  let responseBody;\n\n  if (contentType && contentType.includes('application/json')) {\n    responseBody = await response.json();\n  } else {\n    responseBody = await response.text();\n  }\n\n  if (options.onResponse) {\n    try {\n      options.onResponse(response.clone());\n      // eslint-disable-next-line no-empty\n    } catch {}\n  }\n\n  if (response.ok) {\n    return responseBody as T;\n  }\n\n  throw new SdkError(responseBody, response);\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeUrl, request, RequestOptions } from './rest';\nimport { Config } from './types';\n\ntype OnResponse = RequestOptions['onResponse'];\n\nexport abstract class Base {\n  baseUrl: string;\n\n  private _onResponse?: OnResponse;\n\n  constructor(public config: Config, public region = 'us-east') {\n    this.baseUrl = makeUrl(config.scheme, config.host, config.port);\n  }\n\n  onResponse(onResponse: OnResponse) {\n    this._onResponse = onResponse;\n  }\n\n  protected async request<T>(\n    path: string,\n    options: Omit<RequestOptions, 'body'> = {},\n  ) {\n    const url = `${this.baseUrl}/${path}`;\n    const token = await this.config.credentials.getToken(url);\n    const opts: RequestOptions = {\n      ...options,\n\n      onResponse: this._onResponse,\n    };\n\n    if (token) {\n      opts.headers = {\n        authorization: `Bearer ${token}`,\n      };\n    }\n\n    return await request<T>(url, opts);\n  }\n\n  protected async get<T>(path: string, query: RequestOptions['query'] = {}) {\n    return this.request<T>(path, { query, method: 'GET' });\n  }\n\n  protected async post<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'POST', ...options });\n  }\n\n  protected async put<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'PUT', ...options });\n  }\n\n  protected async patch<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'PATCH', ...options });\n  }\n\n  protected async delete<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { ...options, method: 'DELETE' });\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { Database, DatabaseOptions } from './types';\n\nconst ENDPOINT = 'database';\n\ntype ListReponse = { databases: Database[] };\ntype SingleReponse = { database: Database };\ntype DeleteResponse = {\n  name: string;\n  message: string;\n};\n\nexport class DatabaseApi extends Base {\n  async createDatabase(name: string, cloneDatabase?: string) {\n    const result = await this.put<SingleReponse>(ENDPOINT, {\n      body: {\n        name,\n        source_name: cloneDatabase,\n      },\n    });\n\n    return result.database;\n  }\n\n  async listDatabases(options?: DatabaseOptions) {\n    const result = await this.get<ListReponse>(ENDPOINT, options);\n\n    return result.databases;\n  }\n\n  async getDatabase(name: string) {\n    const databases = await this.listDatabases({ name });\n\n    return databases[0];\n  }\n\n  async deleteDatabase(name: string) {\n    const result = await this.delete<DeleteResponse>(ENDPOINT, {\n      body: { name },\n    });\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { LabeledAction } from '../transaction/types';\n\nexport function makeLabeledAction(\n  name: string,\n  action: LabeledAction['action'],\n) {\n  const labeledAction: LabeledAction = {\n    type: 'LabeledAction',\n    name: name,\n    action,\n  };\n\n  return labeledAction;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type RelValue = string | number | boolean | null | number[];\n\nexport type RelKey = {\n  type: 'RelKey';\n  name: string;\n  keys: string[];\n  values: string[];\n};\n\nexport type Relation = {\n  type: 'Relation';\n  rel_key: RelKey;\n  columns: RelValue[][];\n};\n\nexport type Model = {\n  name: string;\n  value: string;\n  type: string;\n  path?: string;\n};\n\nexport type IntegrityConstraintViolation = {\n  type: 'IntegrityConstraintViolation';\n  sources: {\n    rel_key: RelKey;\n    source: string;\n    type: string;\n  }[];\n};\n\nexport type ClientProblem = {\n  type: 'ClientProblem';\n  error_code: string;\n  is_error: boolean;\n  is_exception: boolean;\n  message: string;\n  path: string;\n  report: string;\n};\n\nexport type Problem = IntegrityConstraintViolation | ClientProblem;\n\nexport type LabeledAction = {\n  type: 'LabeledAction';\n  name: string;\n  action:\n    | QueryAction\n    | ModifyWorkspaceAction\n    | InstallAction\n    | ListSourceAction\n    | ListEdbAction;\n};\n\nexport type LabeledActionResult = {\n  type: 'LabeledActionResult';\n  name: string;\n  result:\n    | QueryActionResult\n    | ModifyWorkspaceActionResult\n    | InstallActionResult\n    | ListSourceActionResult\n    | ListEdbActionResult;\n};\n\nexport type QueryAction = {\n  type: 'QueryAction';\n  inputs: Relation[];\n  outputs: string[];\n  persist: string[];\n  source: Model;\n};\n\nexport type QueryActionResult = {\n  type: 'QueryActionResult';\n  output: Relation[];\n};\n\nexport type ModifyWorkspaceAction = {\n  type: 'ModifyWorkspaceAction';\n  delete_edb?: string;\n  delete_source?: string[];\n};\n\nexport type ModifyWorkspaceActionResult = {\n  type: 'ModifyWorkspaceActionResult';\n  delete_edb_result?: RelKey[];\n};\n\nexport type InstallAction = {\n  type: 'InstallAction';\n  sources: Model[];\n};\n\nexport type InstallActionResult = {\n  type: 'InstallActionResult';\n};\n\nexport type ListSourceAction = {\n  type: 'ListSourceAction';\n};\n\nexport type ListSourceActionResult = {\n  type: 'ListSourceActionResult';\n  sources: Model[];\n};\n\nexport type ListEdbAction = {\n  type: 'ListEdbAction';\n};\n\nexport type ListEdbActionResult = {\n  type: 'ListEdbActionResult';\n  rels: RelKey[];\n};\n\nexport enum TransactionMode {\n  OPEN = 'OPEN',\n  CREATE = 'CREATE',\n  CREATE_OVERWRITE = 'CREATE_OVERWRITE',\n  OPEN_OR_CREATE = 'OPEN_OR_CREATE',\n  CLONE = 'CLONE',\n  CLONE_OVERWRITE = 'CLONE_OVERWRITE',\n}\n\nexport type Transaction = {\n  type: 'Transaction';\n  abort: boolean;\n  dbname: string;\n  mode: TransactionMode;\n  nowait_durable: boolean;\n  readonly: boolean;\n  version: number;\n  actions: LabeledAction[];\n  computeName?: string;\n  source_dbname?: string;\n};\n\nexport type TransactionResult = {\n  type: 'TransactionResult';\n  aborted: boolean;\n  debug_level: number;\n  version: number;\n  output: Relation[];\n  problems: Problem[];\n  actions: LabeledActionResult[];\n};\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { makeLabeledAction } from './transactionUtils';\nimport {\n  LabeledAction,\n  Transaction,\n  TransactionMode,\n  TransactionResult,\n} from './types';\n\nconst ENDPOINT = 'transaction';\n\nexport class TransactionApi extends Base {\n  async runTransaction(\n    database: string,\n    engine: string,\n    transaction: Transaction,\n    mode = TransactionMode.OPEN,\n  ) {\n    const query = {\n      dbname: database,\n      compute_name: engine,\n      open_mode: mode,\n      region: this.region,\n    };\n\n    return await this.post<TransactionResult>(ENDPOINT, {\n      query,\n      body: transaction,\n    });\n  }\n\n  async runActions(\n    database: string,\n    engine: string,\n    actions: LabeledAction['action'][],\n    readonly = true,\n  ) {\n    const labeledActions = actions.map((action, i) =>\n      makeLabeledAction(`action-${i}`, action),\n    );\n    const transaction: Transaction = {\n      type: 'Transaction',\n      abort: false,\n      dbname: database,\n      mode: TransactionMode.OPEN,\n      nowait_durable: false,\n      readonly,\n      version: 0,\n      actions: labeledActions,\n      computeName: engine,\n    };\n\n    return await this.runTransaction(database, engine, transaction);\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport { ListEdbAction, ModifyWorkspaceAction } from '../transaction/types';\n\nexport class EdbApi extends TransactionApi {\n  async listEdbs(database: string, engine: string) {\n    const action: ListEdbAction = {\n      type: 'ListEdbAction',\n    };\n    const result = await this.runActions(database, engine, [action]);\n\n    if (result.actions[0]?.result?.type === 'ListEdbActionResult') {\n      return result.actions[0].result.rels;\n    }\n\n    throw new Error('ListEdbActionResult is missing');\n  }\n\n  async deleteEdb(database: string, engine: string, name: string) {\n    const action: ModifyWorkspaceAction = {\n      type: 'ModifyWorkspaceAction',\n      delete_edb: name,\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'ModifyWorkspaceActionResult') {\n      return result.actions[0].result.delete_edb_result;\n    }\n\n    throw new Error('ModifyWorkspaceActionResult is missing');\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type Engine = {\n  id: string;\n  name: string;\n  size: string;\n  region: string;\n  state: string;\n  created_by: string;\n  requested_on: string;\n  created_on: string;\n  deleted_on: string;\n};\n\nexport type EngineOptions = {\n  id?: string | string[];\n  name?: string | string[];\n  size?: string | string[];\n  state?: EngineState | EngineState[];\n};\n\nexport enum EngineSize {\n  XS = 'XS',\n  S = 'S',\n  M = 'M',\n  L = 'L',\n  XL = 'XL',\n}\n\nexport enum EngineState {\n  REQUESTED = 'REQUESTED',\n  PROVISIONING = 'PROVISIONING',\n  REGISTERING = 'REGISTERING',\n  PROVISIONED = 'PROVISIONED',\n  PROVISION_FAILED = 'PROVISION_FAILED',\n  DELETE_REQUESTED = 'DELETE_REQUESTED',\n  STOPPING = 'STOPPING',\n  DELETING = 'DELETING',\n  DELETED = 'DELETED',\n  DELETION_FAILED = 'DELETION_FAILED',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { Engine, EngineOptions, EngineSize, EngineState } from './types';\n\nconst ENDPOINT = 'compute';\n\ntype ListReponse = { computes: Engine[] };\ntype SingleReponse = { compute: Engine };\ntype DeleteResponse = {\n  status: {\n    name: string;\n    state: EngineState;\n    message: string;\n  };\n};\n\nexport class EngineApi extends Base {\n  async createEngine(name: string, size: EngineSize = EngineSize.XS) {\n    const result = await this.put<SingleReponse>(ENDPOINT, {\n      body: {\n        region: this.region,\n        name,\n        size,\n      },\n    });\n\n    return result.compute;\n  }\n\n  async listEngines(options?: EngineOptions) {\n    const result = await this.get<ListReponse>(ENDPOINT, options);\n\n    return result.computes;\n  }\n\n  async getEngine(name: string) {\n    const engines = await this.listEngines({ name });\n\n    return engines[0];\n  }\n\n  async deleteEngine(name: string) {\n    const result = await this.delete<DeleteResponse>(ENDPOINT, {\n      body: { name },\n    });\n\n    return result.status;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport {\n  InstallAction,\n  ListSourceAction,\n  Model,\n  ModifyWorkspaceAction,\n} from '../transaction/types';\n\nexport class ModelApi extends TransactionApi {\n  async installModels(database: string, engine: string, models: Model[]) {\n    const action: InstallAction = {\n      type: 'InstallAction',\n      sources: models,\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'InstallActionResult') {\n      return result.actions[0].result;\n    }\n\n    throw new Error('InstallActionResult is missing');\n  }\n\n  async listModels(database: string, engine: string) {\n    const action: ListSourceAction = {\n      type: 'ListSourceAction',\n    };\n    const result = await this.runActions(database, engine, [action]);\n\n    if (result.actions[0]?.result?.type === 'ListSourceActionResult') {\n      return result.actions[0].result.sources;\n    }\n\n    throw new Error('ListSourceActionResult is missing');\n  }\n\n  async getModel(database: string, engine: string, name: string) {\n    const models = await this.listModels(database, engine);\n    const model = models.find(m => m.name === name);\n\n    if (model) {\n      return model;\n    }\n\n    throw new Error(`Model '${name}' not found`);\n  }\n\n  async deleteModel(database: string, engine: string, name: string) {\n    const action: ModifyWorkspaceAction = {\n      type: 'ModifyWorkspaceAction',\n      delete_source: [name],\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'ModifyWorkspaceActionResult') {\n      return result.actions[0].result;\n    }\n\n    throw new Error('ModifyWorkspaceActionResult is missing');\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { CompactOAuthClient, OAuthClient, Permission } from './types';\n\nconst ENDPOINT = 'oauth-clients';\n\ntype ListReponse = { clients: CompactOAuthClient[] };\ntype SingleReponse = { client: OAuthClient };\ntype DeleteResponse = {\n  client_id: string;\n  message: string;\n};\n\nexport class OAuthClientApi extends Base {\n  async createOAuthClient(name: string, permissions?: Permission[]) {\n    const result = await this.post<SingleReponse>(ENDPOINT, {\n      body: {\n        name,\n        permissions,\n      },\n    });\n\n    return result.client;\n  }\n\n  async listOAuthClients() {\n    const result = await this.get<ListReponse>(ENDPOINT);\n\n    return result.clients;\n  }\n\n  async getOAuthClient(clientId: string) {\n    const result = await this.get<SingleReponse>(`${ENDPOINT}/${clientId}`);\n\n    return result.client;\n  }\n\n  async updateOAuthClient(\n    clientId: string,\n    name?: string,\n    permissions?: Permission[],\n  ) {\n    const body: any = {};\n\n    if (name) {\n      body.name = name;\n    }\n\n    if (permissions) {\n      body.permissions = permissions;\n    }\n\n    const result = await this.patch<SingleReponse>(`${ENDPOINT}/${clientId}`, {\n      body,\n    });\n\n    return result.client;\n  }\n\n  async rotateOAuthClientSecret(clientId: string) {\n    const result = await this.post<SingleReponse>(\n      `${ENDPOINT}/${clientId}/rotate-secret`,\n      {},\n    );\n\n    return result.client;\n  }\n\n  async deleteOAuthClient(clientId: string) {\n    const result = await this.delete<DeleteResponse>(\n      `${ENDPOINT}/${clientId}`,\n      {},\n    );\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Model } from '../transaction/types';\n\nexport function makeModel(name: string, value: string) {\n  const model: Model = {\n    type: 'Source',\n    name,\n    value,\n    path: name,\n  };\n\n  return model;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeModel } from '../model/modelUtils';\nimport { QueryAction, Relation, RelValue } from '../transaction/types';\nimport { QueryInput } from './types';\n\nexport function makeQueryAction(\n  queryString: string,\n  inputs: QueryInput[] = [],\n) {\n  const action: QueryAction = {\n    type: 'QueryAction',\n    outputs: [],\n    persist: [],\n    source: makeModel('query', queryString),\n    inputs: inputs.map(input => makeQueryInput(input.name, input.value)),\n  };\n\n  return action;\n}\n\nexport const makeQueryInput = (name: string, value: RelValue) => {\n  const input: Relation = {\n    rel_key: {\n      values: [],\n      name: name,\n      keys: ['RAI_VariableSizeStrings.VariableSizeString'],\n      type: 'RelKey',\n    },\n    type: 'Relation',\n    columns: [[value]],\n  };\n\n  return input;\n};\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport { makeQueryAction } from './queryUtils';\nimport { CsvConfigSchema, CsvConfigSyntax, QueryInput } from './types';\n\nexport class QueryApi extends TransactionApi {\n  async query(\n    database: string,\n    engine: string,\n    queryString: string,\n    inputs: QueryInput[] = [],\n    readonly = true,\n  ) {\n    const action = makeQueryAction(queryString, inputs);\n\n    return await this.runActions(database, engine, [action], readonly);\n  }\n\n  async loadJson(\n    database: string,\n    engine: string,\n    relation: string,\n    json: any,\n  ) {\n    const qs = [\n      `def config:data = data`,\n      `def insert:${relation} = load_json[config]`,\n    ];\n    const inputs: QueryInput[] = [\n      {\n        name: 'data',\n        value: JSON.stringify(json),\n      },\n    ];\n\n    return this.query(database, engine, qs.join('\\n'), inputs, false);\n  }\n\n  async loadCsv(\n    database: string,\n    engine: string,\n    relation: string,\n    csv: string,\n    syntax?: CsvConfigSyntax,\n    schema?: CsvConfigSchema,\n  ) {\n    const qs = [`def config:data = data`];\n    const inputs: QueryInput[] = [\n      {\n        name: 'data',\n        value: csv,\n      },\n    ];\n\n    if (syntax) {\n      qs.push(...syntaxToRel(syntax));\n    }\n\n    if (schema) {\n      qs.push(...schemaToRel(schema));\n    }\n\n    qs.push(`def insert:${relation} = load_csv[config]`);\n\n    return this.query(database, engine, qs.join('\\n'), inputs, false);\n  }\n}\n\nfunction toRelLiteral(value: any) {\n  if (typeof value === 'string') {\n    if (value.length === 1) {\n      const escapedValue = value.replace(/'/g, \"\\\\'\");\n\n      return `'${escapedValue}'`;\n    }\n\n    const escapedValue = value.replace(/\"/g, '\\\\\"');\n\n    return `\"${escapedValue}\"`;\n  }\n\n  if (typeof value === 'number') {\n    return value;\n  }\n\n  if (typeof value === 'boolean') {\n    return value ? 'true' : 'false';\n  }\n}\n\nfunction syntaxToRel(syntax: CsvConfigSyntax) {\n  const qs: string[] = [];\n\n  Object.keys(syntax).forEach(k => {\n    const prop = k as keyof CsvConfigSyntax;\n\n    if (prop === 'header') {\n      const headerStr = Object.keys(syntax.header!)\n        .map(key => {\n          return `(${key}, ${toRelLiteral(syntax.header![key])})`;\n        })\n        .join('; ');\n      qs.push(`def config:syntax:header = ${headerStr}`);\n    } else {\n      qs.push(`def config:syntax:${prop} = ${toRelLiteral(syntax[prop])}`);\n    }\n  });\n\n  return qs;\n}\n\nfunction schemaToRel(schema: CsvConfigSchema) {\n  const qs: string[] = [];\n\n  Object.keys(schema).forEach(colName => {\n    qs.push(`def config:schema${colName} = ${toRelLiteral(schema[colName])}`);\n  });\n\n  return qs;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type User = {\n  id: string;\n  email: string;\n  roles: UserRole[];\n  id_providers: string[];\n  status: UserStatus;\n};\n\nexport enum UserStatus {\n  ACTIVE = 'ACTIVE',\n  INACTIVE = 'INACTIVE',\n}\n\nexport enum UserRole {\n  USER = 'user',\n  ADMIN = 'admin',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { User, UserRole, UserStatus } from './types';\n\nconst ENDPOINT = 'users';\n\ntype ListReponse = { users: User[] };\ntype SingleReponse = { user: User };\ntype DeleteResponse = {\n  user_id: string;\n  message: string;\n};\n\nexport class UserApi extends Base {\n  async createUser(email: string, roles: UserRole[]) {\n    const result = await this.post<SingleReponse>(ENDPOINT, {\n      body: {\n        email,\n        roles,\n      },\n    });\n\n    return result.user;\n  }\n\n  async listUsers() {\n    const result = await this.get<ListReponse>(ENDPOINT);\n\n    return result.users;\n  }\n\n  async getUser(userId: string) {\n    const result = await this.get<SingleReponse>(`${ENDPOINT}/${userId}`);\n\n    return result.user;\n  }\n\n  async updateUser(userId: string, status?: UserStatus, roles?: UserRole[]) {\n    const body: any = {};\n\n    if (status) {\n      body.status = status;\n    }\n\n    if (roles && roles.length) {\n      body.roles = roles;\n    }\n\n    const result = await this.patch<SingleReponse>(`${ENDPOINT}/${userId}`, {\n      body,\n    });\n\n    return result.user;\n  }\n\n  async enableUser(userId: string) {\n    return await this.updateUser(userId, UserStatus.ACTIVE);\n  }\n\n  async disableUser(userId: string) {\n    return await this.updateUser(userId, UserStatus.INACTIVE);\n  }\n\n  async deleteUser(userId: string) {\n    const result = await this.delete<DeleteResponse>(\n      `${ENDPOINT}/${userId}`,\n      {},\n    );\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n// See https://www.typescriptlang.org/docs/handbook/mixins.html#alternative-pattern\nexport function applyMixins(derivedCtor: any, constructors: any[]) {\n  constructors.forEach(baseCtor => {\n    Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\n      Object.defineProperty(\n        derivedCtor.prototype,\n        name,\n        Object.getOwnPropertyDescriptor(baseCtor.prototype, name) ||\n          Object.create(null),\n      );\n    });\n  });\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from './base';\nimport { DatabaseApi } from './database/databaseApi';\nimport { EdbApi } from './edb/edbApi';\nimport { EngineApi } from './engine/engineApi';\nimport { ModelApi } from './model/modelApi';\nimport { OAuthClientApi } from './oauthClient/oauthClientApi';\nimport { QueryApi } from './query/queryApi';\nimport { TransactionApi } from './transaction/transactionApi';\nimport { UserApi } from './user/userApi';\nimport { applyMixins } from './utils';\n\nclass Client extends Base {}\n\n// eslint-disable-next-line no-redeclare\ninterface Client\n  extends DatabaseApi,\n    EdbApi,\n    EngineApi,\n    ModelApi,\n    OAuthClientApi,\n    QueryApi,\n    TransactionApi,\n    UserApi {}\n\napplyMixins(Client, [\n  DatabaseApi,\n  EdbApi,\n  EngineApi,\n  ModelApi,\n  OAuthClientApi,\n  QueryApi,\n  TransactionApi,\n  UserApi,\n]);\n\nexport default Client;\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { request } from './rest';\nimport { AccessTokenCache } from './types';\n\nexport abstract class Credentials {\n  abstract getToken(url: string): Promise<string>;\n}\n\ntype GetToken = (url: string) => Promise<string>;\n\nexport class GetTokenCredentials extends Credentials {\n  getToken: GetToken;\n\n  constructor(getToken: GetToken) {\n    super();\n\n    this.getToken = getToken;\n  }\n}\n\nclass AccessToken {\n  constructor(\n    public token: string,\n    public experiesIn: number,\n    public createdOn: number,\n  ) {}\n\n  get isExpired() {\n    const delta = Date.now() - this.createdOn;\n\n    // experiesIn stored in seconds\n    return delta / 1000 >= this.experiesIn;\n  }\n}\n\ntype TokenRequest = {\n  client_id: string;\n  client_secret: string;\n  grant_type: string;\n  audience: string;\n};\n\ntype TokenResponse = {\n  access_token: string;\n  expires_in: number;\n};\n\ntype ReadCacheFn = () => Promise<AccessTokenCache | undefined>;\ntype WriteCacheFn = (c: AccessTokenCache) => Promise<void>;\n\nexport class ClientCredentials extends Credentials {\n  clientId: string;\n  clientSecret: string;\n  clientCredentialsUrl: string;\n  accessToken?: AccessToken;\n\n  constructor(\n    clientId: string,\n    clientSecret: string,\n    clientCredentialsUrl: string,\n    private readCache?: ReadCacheFn,\n    private writeCache?: WriteCacheFn,\n  ) {\n    super();\n\n    this.clientId = clientId;\n    this.clientSecret = clientSecret;\n    this.clientCredentialsUrl = clientCredentialsUrl;\n  }\n\n  async getToken(requestedUrl: string) {\n    await this.readTokenFromCache();\n\n    if (this.accessToken && !this.accessToken.isExpired) {\n      return this.accessToken.token;\n    }\n\n    return this.requestToken(requestedUrl);\n  }\n\n  private async readTokenFromCache() {\n    if (!this.accessToken && this.readCache) {\n      const cache = await this.readCache();\n\n      if (cache) {\n        this.accessToken = new AccessToken(\n          cache.access_token,\n          cache.expires_in,\n          cache.created_on,\n        );\n      }\n    }\n  }\n\n  private async requestToken(requestedUrl: string) {\n    const parsedUrl = new URL(requestedUrl);\n    const body: TokenRequest = {\n      client_id: this.clientId,\n      client_secret: this.clientSecret,\n      grant_type: 'client_credentials',\n      // ensure the audience contains the protocol scheme\n      audience: `https://${parsedUrl.hostname}`,\n    };\n\n    const data = await request<TokenResponse>(this.clientCredentialsUrl, {\n      method: 'POST',\n      body,\n    });\n\n    const token: AccessTokenCache = {\n      access_token: data.access_token,\n      expires_in: data.expires_in,\n      created_on: Date.now(),\n    };\n\n    this.accessToken = new AccessToken(\n      token.access_token,\n      token.expires_in,\n      token.created_on,\n    );\n\n    if (this.writeCache) {\n      await this.writeCache(token);\n    }\n\n    return this.accessToken.token;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-env node */\n/* eslint-disable no-console */\n\nimport { ConfigIniParser } from 'config-ini-parser';\nimport { promises } from 'fs';\nimport { homedir } from 'os';\n\nimport { ClientCredentials } from './credentials';\nimport { AccessTokenCache, Config } from './types';\n\nconst { readFile, writeFile } = promises;\n\nexport async function readConfig(\n  profile = 'default',\n  configPath = '~/.rai/config',\n) {\n  configPath = resolveHome(configPath);\n\n  try {\n    const strCfg = await readFile(configPath, 'utf-8');\n    const configParser = new ConfigIniParser();\n\n    configParser.parse(strCfg);\n\n    if (!configParser.isHaveSection(profile)) {\n      throw new Error(`Profile '${profile}' not found in ${configPath}`);\n    }\n\n    return readClientCredentials(configParser, profile);\n  } catch (error: unknown) {\n    if (isNodeError(error) && error.code === 'ENOENT') {\n      throw new Error(`Can't find file: ${configPath}`);\n    } else {\n      throw error;\n    }\n  }\n}\n\nconst REQUIRED_FIELDS = ['host', 'client_id', 'client_secret'];\nconst DEFAULT_PORT = '443';\nconst DEFAULT_SCHEME = 'https';\nconst DEFAULT_CLIENT_CREDENTIALS_URL =\n  'https://login.relationalai.com/oauth/token';\n\nfunction readClientCredentials(configParser: ConfigIniParser, profile: string) {\n  for (const field of REQUIRED_FIELDS) {\n    if (!configParser.get(profile, field, '')) {\n      throw new Error(`Can't find ${field} field in ${profile} profile`);\n    }\n  }\n\n  const config: Config = {\n    host: configParser.get(profile, 'host', ''),\n    port: configParser.get(profile, 'port', DEFAULT_PORT),\n    scheme: configParser.get(profile, 'scheme', DEFAULT_SCHEME),\n    credentials: new ClientCredentials(\n      configParser.get(profile, 'client_id', ''),\n      configParser.get(profile, 'client_secret', ''),\n      configParser.get(\n        profile,\n        'client_credentials_url',\n        DEFAULT_CLIENT_CREDENTIALS_URL,\n      ),\n      async () => await readTokenCache(profile),\n      async cache => await writeTokenCache(cache, profile),\n    ),\n  };\n\n  return config;\n}\n\nfunction isNodeError(error: unknown): error is NodeJS.ErrnoException {\n  return error instanceof Error;\n}\n\nfunction resolveHome(path: string) {\n  if (path.startsWith('~/')) {\n    return `${homedir()}/${path.slice(2)}`;\n  }\n\n  return path;\n}\n\nfunction makeTokenCachePath(profile: string) {\n  return resolveHome(`~/.rai/${profile}_cache.json`);\n}\n\nasync function readTokenCache(profile = 'default') {\n  const cachePath = makeTokenCachePath(profile);\n\n  try {\n    const cachedStr = await readFile(cachePath, 'utf-8');\n    const cache = JSON.parse(cachedStr);\n\n    if (cache.access_token && cache.created_on && cache.expires_in) {\n      return cache as AccessTokenCache;\n    }\n    // eslint-disable-next-line no-empty\n  } catch {}\n}\n\nasync function writeTokenCache(token: AccessTokenCache, profile = 'default') {\n  const cachePath = makeTokenCachePath(profile);\n  const cacheStr = JSON.stringify(token, null, 2);\n\n  await writeFile(cachePath, cacheStr, 'utf-8');\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type Database = {\n  id: string;\n  name: string;\n  state: DatabaseState;\n  region: string;\n  created_by: string;\n};\n\nexport type DatabaseOptions = {\n  id?: string | string[];\n  name?: string | string[];\n  state?: DatabaseState | DatabaseState[];\n};\n\nexport enum DatabaseState {\n  CREATED = 'CREATED',\n  CREATING = 'CREATING',\n  CREATION_FAILED = 'CREATION_FAILED',\n  DELETED = 'DELETED',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type OAuthClient = {\n  id: string;\n  name: string;\n  secret: string;\n  created_on: string;\n  created_by: string;\n  permissions: Permission[];\n};\n\nexport type CompactOAuthClient = Pick<\n  OAuthClient,\n  'id' | 'name' | 'created_by' | 'created_on'\n>;\n\nexport enum Permission {\n  // engines\n  CREATE_COMPUTE = 'create:compute',\n  DELETE_COMPUTE = 'delete:compute',\n  LIST_COMPUTES = 'list:compute',\n  READ_COMPUTE = 'read:compute',\n  // databases\n  LIST_DATABASES = 'list:database',\n  UPDATE_DATABASE = 'update:database',\n  DELETE_DATABASE = 'delete:database',\n  // transactions\n  RUN_TRANSACTION = 'run:transaction',\n  // credits\n  READ_CREDITS_USAGE = 'read:credits_usage',\n  // oauth clients\n  CREATE_OAUTH_CLIENT = 'create:oauth_client',\n  READ_OAUTH_CLIENT = 'read:oauth_client',\n  LIST_OAUTH_CLIENTS = 'list:oauth_client',\n  UPDATE_OAUTH_CLIENT = 'update:oauth_client',\n  DELETE_OAUTH_CLIENT = 'delete:oauth_client',\n  ROTATE_OAUTH_CLIENT_SECRET = 'rotate:oauth_client_secret',\n  // users\n  CREATE_USER = 'create:user',\n  LIST_USERS = 'list:user',\n  READ_USER = 'read:user',\n  UPDATE_USER = 'update:user',\n  // roles\n  LIST_ROLES = 'list:role',\n  READ_ROLE = 'read:role',\n  // permissions\n  LIST_PERMISSIONS = 'list:permission',\n  // access keys\n  CREATE_ACCESS_KEY = 'create:accesskey',\n  LIST_ACCESS_KEYS = 'list:accesskey',\n}\n"],"names":["VERSION","isNode","process","versions","node","addDefaultHeaders","headers","url","sdkUserAgent","defaultHeaders","Accept","parsedUrl","URL","hostname","makeUrl","scheme","host","port","replace","SdkError","Error","constructor","body","response","status","message","details","problems","name","statusText","undefined","toString","request","options","opts","method","JSON","stringify","fullUrl","query","Object","keys","length","arrayFormat","fetch","contentType","get","responseBody","includes","json","text","onResponse","clone","ok","Base","config","region","baseUrl","_onResponse","path","token","credentials","getToken","authorization","post","put","patch","delete","ENDPOINT","DatabaseApi","createDatabase","cloneDatabase","result","source_name","database","listDatabases","databases","getDatabase","deleteDatabase","makeLabeledAction","action","labeledAction","type","TransactionMode","TransactionApi","runTransaction","engine","transaction","mode","OPEN","dbname","compute_name","open_mode","runActions","actions","readonly","labeledActions","map","i","abort","nowait_durable","version","computeName","EdbApi","listEdbs","rels","deleteEdb","delete_edb","delete_edb_result","EngineSize","EngineState","EngineApi","createEngine","size","XS","compute","listEngines","computes","getEngine","engines","deleteEngine","ModelApi","installModels","models","sources","listModels","getModel","model","find","m","deleteModel","delete_source","OAuthClientApi","createOAuthClient","permissions","client","listOAuthClients","clients","getOAuthClient","clientId","updateOAuthClient","rotateOAuthClientSecret","deleteOAuthClient","makeModel","value","makeQueryAction","queryString","inputs","outputs","persist","source","input","makeQueryInput","rel_key","values","columns","QueryApi","loadJson","relation","qs","join","loadCsv","csv","syntax","schema","push","syntaxToRel","schemaToRel","toRelLiteral","escapedValue","forEach","k","prop","headerStr","header","key","colName","UserStatus","UserRole","UserApi","createUser","email","roles","user","listUsers","users","getUser","userId","updateUser","enableUser","ACTIVE","disableUser","INACTIVE","deleteUser","applyMixins","derivedCtor","constructors","baseCtor","getOwnPropertyNames","prototype","defineProperty","getOwnPropertyDescriptor","create","Client","Credentials","GetTokenCredentials","AccessToken","experiesIn","createdOn","isExpired","delta","Date","now","ClientCredentials","clientSecret","clientCredentialsUrl","readCache","writeCache","accessToken","requestedUrl","readTokenFromCache","requestToken","cache","access_token","expires_in","created_on","client_id","client_secret","grant_type","audience","data","readFile","writeFile","promises","readConfig","profile","configPath","resolveHome","strCfg","configParser","ConfigIniParser","parse","isHaveSection","readClientCredentials","error","isNodeError","code","REQUIRED_FIELDS","DEFAULT_PORT","DEFAULT_SCHEME","DEFAULT_CLIENT_CREDENTIALS_URL","field","readTokenCache","writeTokenCache","startsWith","homedir","slice","makeTokenCachePath","cachePath","cachedStr","cacheStr","DatabaseState","Permission"],"mappings":"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"}