{"version":3,"file":"rai-sdk-javascript.cjs","sources":["../../src/types.ts","../../src/rest.ts","../../src/base.ts","../../src/database/databaseApi.ts","../../src/transaction/transactionUtils.ts","../../src/transaction/types.ts","../../src/transaction/transactionApi.ts","../../src/edb/edbApi.ts","../../src/engine/types.ts","../../src/engine/engineApi.ts","../../src/model/modelApi.ts","../../src/oauthClient/oauthClientApi.ts","../../src/model/modelUtils.ts","../../src/query/queryUtils.ts","../../src/query/queryApi.ts","../../src/user/types.ts","../../src/user/userApi.ts","../../src/utils.ts","../../src/client.ts","../../src/credentials.ts","../../src/config.ts","../../src/database/types.ts","../../src/oauthClient/types.ts"],"sourcesContent":["/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Credentials } from './credentials';\n\nexport const VERSION =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof __RAI_SDK_VERSION__ === 'undefined'\n    ? 'to-be-replaced'\n    : // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      __RAI_SDK_VERSION__; // replaced at build time\n\nexport type Config = {\n  host: string;\n  port: string;\n  scheme: string;\n  credentials: Credentials;\n};\n\nexport interface AccessTokenCache {\n  access_token: string;\n  expires_in: number;\n  created_on: number;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport fetch, { Response } from 'cross-fetch';\nimport { stringify } from 'query-string';\n\nimport { Problem } from './transaction/types';\nimport { VERSION } from './types';\n\nconst isNode =\n  typeof process !== 'undefined' &&\n  process.versions != null &&\n  process.versions.node != null;\n\nexport type RequestOptions = {\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  headers?: Record<string, string>;\n  body?: any;\n  query?: Record<string, any>;\n  onResponse?: (r: Response) => void;\n};\n\nfunction addDefaultHeaders(headers: RequestInit['headers'], url: string) {\n  const sdkUserAgent = `rai-sdk-javascript/${VERSION}`;\n  const defaultHeaders: RequestInit['headers'] = {\n    Accept: 'application/json',\n    'Content-type': 'application/json',\n  };\n\n  if (isNode) {\n    // Only in Node because Browsers won't allow to set\n    const parsedUrl = new URL(url);\n\n    defaultHeaders['Host'] = parsedUrl.hostname;\n    defaultHeaders['User-agent'] = sdkUserAgent;\n  }\n\n  return { ...defaultHeaders, ...headers };\n}\n\nexport function makeUrl(scheme: string, host: string, port: string) {\n  scheme = scheme.replace(/[^A-Za-z]/, '');\n\n  return `${scheme}://${host}${port ? ':' + port : ''}`;\n}\n\nexport class SdkError extends Error {\n  status: string;\n  message: string;\n  details?: string;\n  problems?: Problem[];\n  response: Response;\n\n  constructor(body: any, response: Response) {\n    super('');\n\n    this.name = 'SdkError';\n    this.status = response.statusText;\n    this.response = response;\n\n    if (body.message !== undefined) {\n      this.message = body.message;\n      this.details = body.details;\n      this.status = body.status;\n    } else if (body.problems !== undefined) {\n      this.message = 'Database error. See problems.';\n      this.problems = body.problems;\n    } else {\n      this.message = 'Unknown error occured';\n    }\n  }\n\n  toString() {\n    return `${this.response.status} ${this.status}: ${this.message} ${\n      this.details || ''\n    }`;\n  }\n}\n\nexport async function request<T>(url: string, options: RequestOptions = {}) {\n  const opts = {\n    method: options.method || 'GET',\n    body: JSON.stringify(options.body),\n    headers: addDefaultHeaders(options.headers, url),\n  };\n  const fullUrl =\n    options.query && Object.keys(options.query).length > 0\n      ? `${url}?${stringify(options.query, { arrayFormat: 'none' })}`\n      : url;\n\n  const response = await fetch(fullUrl, opts);\n  const contentType = response.headers.get('content-type');\n  let responseBody;\n\n  if (contentType && contentType.includes('application/json')) {\n    responseBody = await response.json();\n  } else {\n    responseBody = await response.text();\n  }\n\n  if (options.onResponse) {\n    try {\n      options.onResponse(response.clone());\n      // eslint-disable-next-line no-empty\n    } catch {}\n  }\n\n  if (response.ok) {\n    return responseBody as T;\n  }\n\n  throw new SdkError(responseBody, response);\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeUrl, request, RequestOptions } from './rest';\nimport { Config } from './types';\n\ntype OnResponse = RequestOptions['onResponse'];\n\nexport abstract class Base {\n  baseUrl: string;\n\n  private _onResponse?: OnResponse;\n\n  constructor(public config: Config, public region = 'us-east') {\n    this.baseUrl = makeUrl(config.scheme, config.host, config.port);\n  }\n\n  onResponse(onResponse: OnResponse) {\n    this._onResponse = onResponse;\n  }\n\n  protected async request<T>(\n    path: string,\n    options: Omit<RequestOptions, 'body'> = {},\n  ) {\n    const url = `${this.baseUrl}/${path}`;\n    const token = await this.config.credentials.getToken(url);\n    const opts: RequestOptions = {\n      ...options,\n\n      onResponse: this._onResponse,\n    };\n\n    if (token) {\n      opts.headers = {\n        authorization: `Bearer ${token}`,\n      };\n    }\n\n    return await request<T>(url, opts);\n  }\n\n  protected async get<T>(path: string, query: RequestOptions['query'] = {}) {\n    return this.request<T>(path, { query, method: 'GET' });\n  }\n\n  protected async post<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'POST', ...options });\n  }\n\n  protected async put<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'PUT', ...options });\n  }\n\n  protected async patch<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { method: 'PATCH', ...options });\n  }\n\n  protected async delete<T>(\n    path: string,\n    options: Pick<RequestOptions, 'query' | 'body'>,\n  ) {\n    return this.request<T>(path, { ...options, method: 'DELETE' });\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { Database, DatabaseOptions } from './types';\n\nconst ENDPOINT = 'database';\n\ntype ListReponse = { databases: Database[] };\ntype SingleReponse = { database: Database };\ntype DeleteResponse = {\n  name: string;\n  message: string;\n};\n\nexport class DatabaseApi extends Base {\n  async createDatabase(name: string, cloneDatabase?: string) {\n    const result = await this.put<SingleReponse>(ENDPOINT, {\n      body: {\n        name,\n        source_name: cloneDatabase,\n      },\n    });\n\n    return result.database;\n  }\n\n  async listDatabases(options?: DatabaseOptions) {\n    const result = await this.get<ListReponse>(ENDPOINT, options);\n\n    return result.databases;\n  }\n\n  async getDatabase(name: string) {\n    const databases = await this.listDatabases({ name });\n\n    return databases[0];\n  }\n\n  async deleteDatabase(name: string) {\n    const result = await this.delete<DeleteResponse>(ENDPOINT, {\n      body: { name },\n    });\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { LabeledAction } from '../transaction/types';\n\nexport function makeLabeledAction(\n  name: string,\n  action: LabeledAction['action'],\n) {\n  const labeledAction: LabeledAction = {\n    type: 'LabeledAction',\n    name: name,\n    action,\n  };\n\n  return labeledAction;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type RelValue = string | number | boolean | null | number[];\n\nexport type RelKey = {\n  type: 'RelKey';\n  name: string;\n  keys: string[];\n  values: string[];\n};\n\nexport type Relation = {\n  type: 'Relation';\n  rel_key: RelKey;\n  columns: RelValue[][];\n};\n\nexport type Model = {\n  name: string;\n  value: string;\n  type: string;\n  path?: string;\n};\n\nexport type IntegrityConstraintViolation = {\n  type: 'IntegrityConstraintViolation';\n  sources: {\n    rel_key: RelKey;\n    source: string;\n    type: string;\n  }[];\n};\n\nexport type ClientProblem = {\n  type: 'ClientProblem';\n  error_code: string;\n  is_error: boolean;\n  is_exception: boolean;\n  message: string;\n  path: string;\n  report: string;\n};\n\nexport type Problem = IntegrityConstraintViolation | ClientProblem;\n\nexport type LabeledAction = {\n  type: 'LabeledAction';\n  name: string;\n  action:\n    | QueryAction\n    | ModifyWorkspaceAction\n    | InstallAction\n    | ListSourceAction\n    | ListEdbAction;\n};\n\nexport type LabeledActionResult = {\n  type: 'LabeledActionResult';\n  name: string;\n  result:\n    | QueryActionResult\n    | ModifyWorkspaceActionResult\n    | InstallActionResult\n    | ListSourceActionResult\n    | ListEdbActionResult;\n};\n\nexport type QueryAction = {\n  type: 'QueryAction';\n  inputs: Relation[];\n  outputs: string[];\n  persist: string[];\n  source: Model;\n};\n\nexport type QueryActionResult = {\n  type: 'QueryActionResult';\n  output: Relation[];\n};\n\nexport type ModifyWorkspaceAction = {\n  type: 'ModifyWorkspaceAction';\n  delete_edb?: string;\n  delete_source?: string[];\n};\n\nexport type ModifyWorkspaceActionResult = {\n  type: 'ModifyWorkspaceActionResult';\n  delete_edb_result?: RelKey[];\n};\n\nexport type InstallAction = {\n  type: 'InstallAction';\n  sources: Model[];\n};\n\nexport type InstallActionResult = {\n  type: 'InstallActionResult';\n};\n\nexport type ListSourceAction = {\n  type: 'ListSourceAction';\n};\n\nexport type ListSourceActionResult = {\n  type: 'ListSourceActionResult';\n  sources: Model[];\n};\n\nexport type ListEdbAction = {\n  type: 'ListEdbAction';\n};\n\nexport type ListEdbActionResult = {\n  type: 'ListEdbActionResult';\n  rels: RelKey[];\n};\n\nexport enum TransactionMode {\n  OPEN = 'OPEN',\n  CREATE = 'CREATE',\n  CREATE_OVERWRITE = 'CREATE_OVERWRITE',\n  OPEN_OR_CREATE = 'OPEN_OR_CREATE',\n  CLONE = 'CLONE',\n  CLONE_OVERWRITE = 'CLONE_OVERWRITE',\n}\n\nexport type Transaction = {\n  type: 'Transaction';\n  abort: boolean;\n  dbname: string;\n  mode: TransactionMode;\n  nowait_durable: boolean;\n  readonly: boolean;\n  version: number;\n  actions: LabeledAction[];\n  computeName?: string;\n  source_dbname?: string;\n};\n\nexport type TransactionResult = {\n  type: 'TransactionResult';\n  aborted: boolean;\n  debug_level: number;\n  version: number;\n  output: Relation[];\n  problems: Problem[];\n  actions: LabeledActionResult[];\n};\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { makeLabeledAction } from './transactionUtils';\nimport {\n  LabeledAction,\n  Transaction,\n  TransactionMode,\n  TransactionResult,\n} from './types';\n\nconst ENDPOINT = 'transaction';\n\nexport class TransactionApi extends Base {\n  async runTransaction(\n    database: string,\n    engine: string,\n    transaction: Transaction,\n    mode = TransactionMode.OPEN,\n  ) {\n    const query = {\n      dbname: database,\n      compute_name: engine,\n      open_mode: mode,\n      region: this.region,\n    };\n\n    return await this.post<TransactionResult>(ENDPOINT, {\n      query,\n      body: transaction,\n    });\n  }\n\n  async runActions(\n    database: string,\n    engine: string,\n    actions: LabeledAction['action'][],\n    readonly = true,\n  ) {\n    const labeledActions = actions.map((action, i) =>\n      makeLabeledAction(`action-${i}`, action),\n    );\n    const transaction: Transaction = {\n      type: 'Transaction',\n      abort: false,\n      dbname: database,\n      mode: TransactionMode.OPEN,\n      nowait_durable: false,\n      readonly,\n      version: 0,\n      actions: labeledActions,\n      computeName: engine,\n    };\n\n    return await this.runTransaction(database, engine, transaction);\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport { ListEdbAction, ModifyWorkspaceAction } from '../transaction/types';\n\nexport class EdbApi extends TransactionApi {\n  async listEdbs(database: string, engine: string) {\n    const action: ListEdbAction = {\n      type: 'ListEdbAction',\n    };\n    const result = await this.runActions(database, engine, [action]);\n\n    if (result.actions[0]?.result?.type === 'ListEdbActionResult') {\n      return result.actions[0].result.rels;\n    }\n\n    throw new Error('ListEdbActionResult is missing');\n  }\n\n  async deleteEdb(database: string, engine: string, name: string) {\n    const action: ModifyWorkspaceAction = {\n      type: 'ModifyWorkspaceAction',\n      delete_edb: name,\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'ModifyWorkspaceActionResult') {\n      return result.actions[0].result.delete_edb_result;\n    }\n\n    throw new Error('ModifyWorkspaceActionResult is missing');\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type Engine = {\n  id: string;\n  name: string;\n  size: string;\n  region: string;\n  state: string;\n  created_by: string;\n  requested_on: string;\n  created_on: string;\n  deleted_on: string;\n};\n\nexport type EngineOptions = {\n  id?: string | string[];\n  name?: string | string[];\n  size?: string | string[];\n  state?: EngineState | EngineState[];\n};\n\nexport enum EngineSize {\n  XS = 'XS',\n  S = 'S',\n  M = 'M',\n  L = 'L',\n  XL = 'XL',\n}\n\nexport enum EngineState {\n  REQUESTED = 'REQUESTED',\n  PROVISIONING = 'PROVISIONING',\n  REGISTERING = 'REGISTERING',\n  PROVISIONED = 'PROVISIONED',\n  PROVISION_FAILED = 'PROVISION_FAILED',\n  DELETE_REQUESTED = 'DELETE_REQUESTED',\n  STOPPING = 'STOPPING',\n  DELETING = 'DELETING',\n  DELETED = 'DELETED',\n  DELETION_FAILED = 'DELETION_FAILED',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { Engine, EngineOptions, EngineSize, EngineState } from './types';\n\nconst ENDPOINT = 'compute';\n\ntype ListReponse = { computes: Engine[] };\ntype SingleReponse = { compute: Engine };\ntype DeleteResponse = {\n  status: {\n    name: string;\n    state: EngineState;\n    message: string;\n  };\n};\n\nexport class EngineApi extends Base {\n  async createEngine(name: string, size: EngineSize = EngineSize.XS) {\n    const result = await this.put<SingleReponse>(ENDPOINT, {\n      body: {\n        region: this.region,\n        name,\n        size,\n      },\n    });\n\n    return result.compute;\n  }\n\n  async listEngines(options?: EngineOptions) {\n    const result = await this.get<ListReponse>(ENDPOINT, options);\n\n    return result.computes;\n  }\n\n  async getEngine(name: string) {\n    const engines = await this.listEngines({ name });\n\n    return engines[0];\n  }\n\n  async deleteEngine(name: string) {\n    const result = await this.delete<DeleteResponse>(ENDPOINT, {\n      body: { name },\n    });\n\n    return result.status;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport {\n  InstallAction,\n  ListSourceAction,\n  Model,\n  ModifyWorkspaceAction,\n} from '../transaction/types';\n\nexport class ModelApi extends TransactionApi {\n  async installModels(database: string, engine: string, models: Model[]) {\n    const action: InstallAction = {\n      type: 'InstallAction',\n      sources: models,\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'InstallActionResult') {\n      return result.actions[0].result;\n    }\n\n    throw new Error('InstallActionResult is missing');\n  }\n\n  async listModels(database: string, engine: string) {\n    const action: ListSourceAction = {\n      type: 'ListSourceAction',\n    };\n    const result = await this.runActions(database, engine, [action]);\n\n    if (result.actions[0]?.result?.type === 'ListSourceActionResult') {\n      return result.actions[0].result.sources;\n    }\n\n    throw new Error('ListSourceActionResult is missing');\n  }\n\n  async getModel(database: string, engine: string, name: string) {\n    const models = await this.listModels(database, engine);\n    const model = models.find(m => m.name === name);\n\n    if (model) {\n      return model;\n    }\n\n    throw new Error(`Model '${name}' not found`);\n  }\n\n  async deleteModel(database: string, engine: string, name: string) {\n    const action: ModifyWorkspaceAction = {\n      type: 'ModifyWorkspaceAction',\n      delete_source: [name],\n    };\n    const result = await this.runActions(database, engine, [action], false);\n\n    if (result.actions[0]?.result?.type === 'ModifyWorkspaceActionResult') {\n      return result.actions[0].result;\n    }\n\n    throw new Error('ModifyWorkspaceActionResult is missing');\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { CompactOAuthClient, OAuthClient, Permission } from './types';\n\nconst ENDPOINT = 'oauth-clients';\n\ntype ListReponse = { clients: CompactOAuthClient[] };\ntype SingleReponse = { client: OAuthClient };\ntype DeleteResponse = {\n  client_id: string;\n  message: string;\n};\n\nexport class OAuthClientApi extends Base {\n  async createOAuthClient(name: string, permissions?: Permission[]) {\n    const result = await this.post<SingleReponse>(ENDPOINT, {\n      body: {\n        name,\n        permissions,\n      },\n    });\n\n    return result.client;\n  }\n\n  async listOAuthClients() {\n    const result = await this.get<ListReponse>(ENDPOINT);\n\n    return result.clients;\n  }\n\n  async getOAuthClient(clientId: string) {\n    const result = await this.get<SingleReponse>(`${ENDPOINT}/${clientId}`);\n\n    return result.client;\n  }\n\n  async updateOAuthClient(\n    clientId: string,\n    name?: string,\n    permissions?: Permission[],\n  ) {\n    const body: any = {};\n\n    if (name) {\n      body.name = name;\n    }\n\n    if (permissions) {\n      body.permissions = permissions;\n    }\n\n    const result = await this.patch<SingleReponse>(`${ENDPOINT}/${clientId}`, {\n      body,\n    });\n\n    return result.client;\n  }\n\n  async rotateOAuthClientSecret(clientId: string) {\n    const result = await this.post<SingleReponse>(\n      `${ENDPOINT}/${clientId}/rotate-secret`,\n      {},\n    );\n\n    return result.client;\n  }\n\n  async deleteOAuthClient(clientId: string) {\n    const result = await this.delete<DeleteResponse>(\n      `${ENDPOINT}/${clientId}`,\n      {},\n    );\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Model } from '../transaction/types';\n\nexport function makeModel(name: string, value: string) {\n  const model: Model = {\n    type: 'Source',\n    name,\n    value,\n    path: name,\n  };\n\n  return model;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeModel } from '../model/modelUtils';\nimport { QueryAction, Relation, RelValue } from '../transaction/types';\nimport { QueryInput } from './types';\n\nexport function makeQueryAction(\n  queryString: string,\n  inputs: QueryInput[] = [],\n) {\n  const action: QueryAction = {\n    type: 'QueryAction',\n    outputs: [],\n    persist: [],\n    source: makeModel('query', queryString),\n    inputs: inputs.map(input => makeQueryInput(input.name, input.value)),\n  };\n\n  return action;\n}\n\nexport const makeQueryInput = (name: string, value: RelValue) => {\n  const input: Relation = {\n    rel_key: {\n      values: [],\n      name: name,\n      keys: ['RAI_VariableSizeStrings.VariableSizeString'],\n      type: 'RelKey',\n    },\n    type: 'Relation',\n    columns: [[value]],\n  };\n\n  return input;\n};\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n\nimport { TransactionApi } from '../transaction/transactionApi';\nimport { makeQueryAction } from './queryUtils';\nimport { CsvConfigSchema, CsvConfigSyntax, QueryInput } from './types';\n\nexport class QueryApi extends TransactionApi {\n  async query(\n    database: string,\n    engine: string,\n    queryString: string,\n    inputs: QueryInput[] = [],\n    readonly = true,\n  ) {\n    const action = makeQueryAction(queryString, inputs);\n\n    return await this.runActions(database, engine, [action], readonly);\n  }\n\n  async loadJson(\n    database: string,\n    engine: string,\n    relation: string,\n    json: any,\n  ) {\n    const qs = [\n      `def config:data = data`,\n      `def insert:${relation} = load_json[config]`,\n    ];\n    const inputs: QueryInput[] = [\n      {\n        name: 'data',\n        value: JSON.stringify(json),\n      },\n    ];\n\n    return this.query(database, engine, qs.join('\\n'), inputs, false);\n  }\n\n  async loadCsv(\n    database: string,\n    engine: string,\n    relation: string,\n    csv: string,\n    syntax?: CsvConfigSyntax,\n    schema?: CsvConfigSchema,\n  ) {\n    const qs = [`def config:data = data`];\n    const inputs: QueryInput[] = [\n      {\n        name: 'data',\n        value: csv,\n      },\n    ];\n\n    if (syntax) {\n      qs.push(...syntaxToRel(syntax));\n    }\n\n    if (schema) {\n      qs.push(...schemaToRel(schema));\n    }\n\n    qs.push(`def insert:${relation} = load_csv[config]`);\n\n    return this.query(database, engine, qs.join('\\n'), inputs, false);\n  }\n}\n\nfunction toRelLiteral(value: any) {\n  if (typeof value === 'string') {\n    if (value.length === 1) {\n      const escapedValue = value.replace(/'/g, \"\\\\'\");\n\n      return `'${escapedValue}'`;\n    }\n\n    const escapedValue = value.replace(/\"/g, '\\\\\"');\n\n    return `\"${escapedValue}\"`;\n  }\n\n  if (typeof value === 'number') {\n    return value;\n  }\n\n  if (typeof value === 'boolean') {\n    return value ? 'true' : 'false';\n  }\n}\n\nfunction syntaxToRel(syntax: CsvConfigSyntax) {\n  const qs: string[] = [];\n\n  Object.keys(syntax).forEach(k => {\n    const prop = k as keyof CsvConfigSyntax;\n\n    if (prop === 'header') {\n      const headerStr = Object.keys(syntax.header!)\n        .map(key => {\n          return `(${key}, ${toRelLiteral(syntax.header![key])})`;\n        })\n        .join('; ');\n      qs.push(`def config:syntax:header = ${headerStr}`);\n    } else {\n      qs.push(`def config:syntax:${prop} = ${toRelLiteral(syntax[prop])}`);\n    }\n  });\n\n  return qs;\n}\n\nfunction schemaToRel(schema: CsvConfigSchema) {\n  const qs: string[] = [];\n\n  Object.keys(schema).forEach(colName => {\n    qs.push(`def config:schema${colName} = ${toRelLiteral(schema[colName])}`);\n  });\n\n  return qs;\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type User = {\n  id: string;\n  email: string;\n  roles: UserRole[];\n  id_providers: string[];\n  status: UserStatus;\n};\n\nexport enum UserStatus {\n  ACTIVE = 'ACTIVE',\n  INACTIVE = 'INACTIVE',\n}\n\nexport enum UserRole {\n  USER = 'user',\n  ADMIN = 'admin',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from '../base';\nimport { User, UserRole, UserStatus } from './types';\n\nconst ENDPOINT = 'users';\n\ntype ListReponse = { users: User[] };\ntype SingleReponse = { user: User };\ntype DeleteResponse = {\n  user_id: string;\n  message: string;\n};\n\nexport class UserApi extends Base {\n  async createUser(email: string, roles: UserRole[]) {\n    const result = await this.post<SingleReponse>(ENDPOINT, {\n      body: {\n        email,\n        roles,\n      },\n    });\n\n    return result.user;\n  }\n\n  async listUsers() {\n    const result = await this.get<ListReponse>(ENDPOINT);\n\n    return result.users;\n  }\n\n  async getUser(userId: string) {\n    const result = await this.get<SingleReponse>(`${ENDPOINT}/${userId}`);\n\n    return result.user;\n  }\n\n  async updateUser(userId: string, status?: UserStatus, roles?: UserRole[]) {\n    const body: any = {};\n\n    if (status) {\n      body.status = status;\n    }\n\n    if (roles && roles.length) {\n      body.roles = roles;\n    }\n\n    const result = await this.patch<SingleReponse>(`${ENDPOINT}/${userId}`, {\n      body,\n    });\n\n    return result.user;\n  }\n\n  async enableUser(userId: string) {\n    return await this.updateUser(userId, UserStatus.ACTIVE);\n  }\n\n  async disableUser(userId: string) {\n    return await this.updateUser(userId, UserStatus.INACTIVE);\n  }\n\n  async deleteUser(userId: string) {\n    const result = await this.delete<DeleteResponse>(\n      `${ENDPOINT}/${userId}`,\n      {},\n    );\n\n    return result;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n// See https://www.typescriptlang.org/docs/handbook/mixins.html#alternative-pattern\nexport function applyMixins(derivedCtor: any, constructors: any[]) {\n  constructors.forEach(baseCtor => {\n    Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\n      Object.defineProperty(\n        derivedCtor.prototype,\n        name,\n        Object.getOwnPropertyDescriptor(baseCtor.prototype, name) ||\n          Object.create(null),\n      );\n    });\n  });\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Base } from './base';\nimport { DatabaseApi } from './database/databaseApi';\nimport { EdbApi } from './edb/edbApi';\nimport { EngineApi } from './engine/engineApi';\nimport { ModelApi } from './model/modelApi';\nimport { OAuthClientApi } from './oauthClient/oauthClientApi';\nimport { QueryApi } from './query/queryApi';\nimport { TransactionApi } from './transaction/transactionApi';\nimport { UserApi } from './user/userApi';\nimport { applyMixins } from './utils';\n\nclass Client extends Base {}\n\n// eslint-disable-next-line no-redeclare\ninterface Client\n  extends DatabaseApi,\n    EdbApi,\n    EngineApi,\n    ModelApi,\n    OAuthClientApi,\n    QueryApi,\n    TransactionApi,\n    UserApi {}\n\napplyMixins(Client, [\n  DatabaseApi,\n  EdbApi,\n  EngineApi,\n  ModelApi,\n  OAuthClientApi,\n  QueryApi,\n  TransactionApi,\n  UserApi,\n]);\n\nexport default Client;\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nimport { request } from './rest';\nimport { AccessTokenCache } from './types';\n\nexport abstract class Credentials {\n  abstract getToken(url: string): Promise<string>;\n}\n\ntype GetToken = (url: string) => Promise<string>;\n\nexport class GetTokenCredentials extends Credentials {\n  getToken: GetToken;\n\n  constructor(getToken: GetToken) {\n    super();\n\n    this.getToken = getToken;\n  }\n}\n\nclass AccessToken {\n  constructor(\n    public token: string,\n    public experiesIn: number,\n    public createdOn: number,\n  ) {}\n\n  get isExpired() {\n    const delta = Date.now() - this.createdOn;\n\n    // experiesIn stored in seconds\n    return delta / 1000 >= this.experiesIn;\n  }\n}\n\ntype TokenRequest = {\n  client_id: string;\n  client_secret: string;\n  grant_type: string;\n  audience: string;\n};\n\ntype TokenResponse = {\n  access_token: string;\n  expires_in: number;\n};\n\ntype ReadCacheFn = () => Promise<AccessTokenCache | undefined>;\ntype WriteCacheFn = (c: AccessTokenCache) => Promise<void>;\n\nexport class ClientCredentials extends Credentials {\n  clientId: string;\n  clientSecret: string;\n  clientCredentialsUrl: string;\n  accessToken?: AccessToken;\n\n  constructor(\n    clientId: string,\n    clientSecret: string,\n    clientCredentialsUrl: string,\n    private readCache?: ReadCacheFn,\n    private writeCache?: WriteCacheFn,\n  ) {\n    super();\n\n    this.clientId = clientId;\n    this.clientSecret = clientSecret;\n    this.clientCredentialsUrl = clientCredentialsUrl;\n  }\n\n  async getToken(requestedUrl: string) {\n    await this.readTokenFromCache();\n\n    if (this.accessToken && !this.accessToken.isExpired) {\n      return this.accessToken.token;\n    }\n\n    return this.requestToken(requestedUrl);\n  }\n\n  private async readTokenFromCache() {\n    if (!this.accessToken && this.readCache) {\n      const cache = await this.readCache();\n\n      if (cache) {\n        this.accessToken = new AccessToken(\n          cache.access_token,\n          cache.expires_in,\n          cache.created_on,\n        );\n      }\n    }\n  }\n\n  private async requestToken(requestedUrl: string) {\n    const parsedUrl = new URL(requestedUrl);\n    const body: TokenRequest = {\n      client_id: this.clientId,\n      client_secret: this.clientSecret,\n      grant_type: 'client_credentials',\n      // ensure the audience contains the protocol scheme\n      audience: `https://${parsedUrl.hostname}`,\n    };\n\n    const data = await request<TokenResponse>(this.clientCredentialsUrl, {\n      method: 'POST',\n      body,\n    });\n\n    const token: AccessTokenCache = {\n      access_token: data.access_token,\n      expires_in: data.expires_in,\n      created_on: Date.now(),\n    };\n\n    this.accessToken = new AccessToken(\n      token.access_token,\n      token.expires_in,\n      token.created_on,\n    );\n\n    if (this.writeCache) {\n      await this.writeCache(token);\n    }\n\n    return this.accessToken.token;\n  }\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-env node */\n/* eslint-disable no-console */\n\nimport { ConfigIniParser } from 'config-ini-parser';\nimport { promises } from 'fs';\nimport { homedir } from 'os';\n\nimport { ClientCredentials } from './credentials';\nimport { AccessTokenCache, Config } from './types';\n\nconst { readFile, writeFile } = promises;\n\nexport async function readConfig(\n  profile = 'default',\n  configPath = '~/.rai/config',\n) {\n  configPath = resolveHome(configPath);\n\n  try {\n    const strCfg = await readFile(configPath, 'utf-8');\n    const configParser = new ConfigIniParser();\n\n    configParser.parse(strCfg);\n\n    if (!configParser.isHaveSection(profile)) {\n      throw new Error(`Profile '${profile}' not found in ${configPath}`);\n    }\n\n    return readClientCredentials(configParser, profile);\n  } catch (error: unknown) {\n    if (isNodeError(error) && error.code === 'ENOENT') {\n      throw new Error(`Can't find file: ${configPath}`);\n    } else {\n      throw error;\n    }\n  }\n}\n\nconst REQUIRED_FIELDS = ['host', 'client_id', 'client_secret'];\nconst DEFAULT_PORT = '443';\nconst DEFAULT_SCHEME = 'https';\nconst DEFAULT_CLIENT_CREDENTIALS_URL =\n  'https://login.relationalai.com/oauth/token';\n\nfunction readClientCredentials(configParser: ConfigIniParser, profile: string) {\n  for (const field of REQUIRED_FIELDS) {\n    if (!configParser.get(profile, field, '')) {\n      throw new Error(`Can't find ${field} field in ${profile} profile`);\n    }\n  }\n\n  const config: Config = {\n    host: configParser.get(profile, 'host', ''),\n    port: configParser.get(profile, 'port', DEFAULT_PORT),\n    scheme: configParser.get(profile, 'scheme', DEFAULT_SCHEME),\n    credentials: new ClientCredentials(\n      configParser.get(profile, 'client_id', ''),\n      configParser.get(profile, 'client_secret', ''),\n      configParser.get(\n        profile,\n        'client_credentials_url',\n        DEFAULT_CLIENT_CREDENTIALS_URL,\n      ),\n      async () => await readTokenCache(profile),\n      async cache => await writeTokenCache(cache, profile),\n    ),\n  };\n\n  return config;\n}\n\nfunction isNodeError(error: unknown): error is NodeJS.ErrnoException {\n  return error instanceof Error;\n}\n\nfunction resolveHome(path: string) {\n  if (path.startsWith('~/')) {\n    return `${homedir()}/${path.slice(2)}`;\n  }\n\n  return path;\n}\n\nfunction makeTokenCachePath(profile: string) {\n  return resolveHome(`~/.rai/${profile}_cache.json`);\n}\n\nasync function readTokenCache(profile = 'default') {\n  const cachePath = makeTokenCachePath(profile);\n\n  try {\n    const cachedStr = await readFile(cachePath, 'utf-8');\n    const cache = JSON.parse(cachedStr);\n\n    if (cache.access_token && cache.created_on && cache.expires_in) {\n      return cache as AccessTokenCache;\n    }\n    // eslint-disable-next-line no-empty\n  } catch {}\n}\n\nasync function writeTokenCache(token: AccessTokenCache, profile = 'default') {\n  const cachePath = makeTokenCachePath(profile);\n  const cacheStr = JSON.stringify(token, null, 2);\n\n  await writeFile(cachePath, cacheStr, 'utf-8');\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type Database = {\n  id: string;\n  name: string;\n  state: DatabaseState;\n  region: string;\n  created_by: string;\n};\n\nexport type DatabaseOptions = {\n  id?: string | string[];\n  name?: string | string[];\n  state?: DatabaseState | DatabaseState[];\n};\n\nexport enum DatabaseState {\n  CREATED = 'CREATED',\n  CREATING = 'CREATING',\n  CREATION_FAILED = 'CREATION_FAILED',\n  DELETED = 'DELETED',\n}\n","/**\n * Copyright 2021 RelationalAI, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy\n * of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations\n * under the License.\n */\n\nexport type OAuthClient = {\n  id: string;\n  name: string;\n  secret: string;\n  created_on: string;\n  created_by: string;\n  permissions: Permission[];\n};\n\nexport type CompactOAuthClient = Pick<\n  OAuthClient,\n  'id' | 'name' | 'created_by' | 'created_on'\n>;\n\nexport enum Permission {\n  // engines\n  CREATE_COMPUTE = 'create:compute',\n  DELETE_COMPUTE = 'delete:compute',\n  LIST_COMPUTES = 'list:compute',\n  READ_COMPUTE = 'read:compute',\n  // databases\n  LIST_DATABASES = 'list:database',\n  UPDATE_DATABASE = 'update:database',\n  DELETE_DATABASE = 'delete:database',\n  // transactions\n  RUN_TRANSACTION = 'run:transaction',\n  // credits\n  READ_CREDITS_USAGE = 'read:credits_usage',\n  // oauth clients\n  CREATE_OAUTH_CLIENT = 'create:oauth_client',\n  READ_OAUTH_CLIENT = 'read:oauth_client',\n  LIST_OAUTH_CLIENTS = 'list:oauth_client',\n  UPDATE_OAUTH_CLIENT = 'update:oauth_client',\n  DELETE_OAUTH_CLIENT = 'delete:oauth_client',\n  ROTATE_OAUTH_CLIENT_SECRET = 'rotate:oauth_client_secret',\n  // users\n  CREATE_USER = 'create:user',\n  LIST_USERS = 'list:user',\n  READ_USER = 'read:user',\n  UPDATE_USER = 'update:user',\n  // roles\n  LIST_ROLES = 'list:role',\n  READ_ROLE = 'read:role',\n  // permissions\n  LIST_PERMISSIONS = 'list:permission',\n  // access keys\n  CREATE_ACCESS_KEY = 'create:accesskey',\n  LIST_ACCESS_KEYS = 'list:accesskey',\n}\n"],"names":["VERSION","isNode","process","versions","node","addDefaultHeaders","headers","url","sdkUserAgent","defaultHeaders","Accept","parsedUrl","URL","hostname","makeUrl","scheme","host","port","replace","SdkError","Error","constructor","body","response","status","message","details","problems","name","statusText","undefined","toString","request","options","opts","method","JSON","stringify","fullUrl","query","Object","keys","length","arrayFormat","fetch","contentType","get","responseBody","includes","json","text","onResponse","clone","ok","Base","config","region","baseUrl","_onResponse","path","token","credentials","getToken","authorization","post","put","patch","delete","ENDPOINT","DatabaseApi","createDatabase","cloneDatabase","result","source_name","database","listDatabases","databases","getDatabase","deleteDatabase","makeLabeledAction","action","labeledAction","type","TransactionMode","TransactionApi","runTransaction","engine","transaction","mode","OPEN","dbname","compute_name","open_mode","runActions","actions","readonly","labeledActions","map","i","abort","nowait_durable","version","computeName","EdbApi","listEdbs","rels","deleteEdb","delete_edb","delete_edb_result","EngineSize","EngineState","EngineApi","createEngine","size","XS","compute","listEngines","computes","getEngine","engines","deleteEngine","ModelApi","installModels","models","sources","listModels","getModel","model","find","m","deleteModel","delete_source","OAuthClientApi","createOAuthClient","permissions","client","listOAuthClients","clients","getOAuthClient","clientId","updateOAuthClient","rotateOAuthClientSecret","deleteOAuthClient","makeModel","value","makeQueryAction","queryString","inputs","outputs","persist","source","input","makeQueryInput","rel_key","values","columns","QueryApi","loadJson","relation","qs","join","loadCsv","csv","syntax","schema","push","syntaxToRel","schemaToRel","toRelLiteral","escapedValue","forEach","k","prop","headerStr","header","key","colName","UserStatus","UserRole","UserApi","createUser","email","roles","user","listUsers","users","getUser","userId","updateUser","enableUser","ACTIVE","disableUser","INACTIVE","deleteUser","applyMixins","derivedCtor","constructors","baseCtor","getOwnPropertyNames","prototype","defineProperty","getOwnPropertyDescriptor","create","Client","Credentials","GetTokenCredentials","AccessToken","experiesIn","createdOn","isExpired","delta","Date","now","ClientCredentials","clientSecret","clientCredentialsUrl","readCache","writeCache","accessToken","requestedUrl","readTokenFromCache","requestToken","cache","access_token","expires_in","created_on","client_id","client_secret","grant_type","audience","data","readFile","writeFile","promises","readConfig","profile","configPath","resolveHome","strCfg","configParser","ConfigIniParser","parse","isHaveSection","readClientCredentials","error","isNodeError","code","REQUIRED_FIELDS","DEFAULT_PORT","DEFAULT_SCHEME","DEFAULT_CLIENT_CREDENTIALS_URL","field","readTokenCache","writeTokenCache","startsWith","homedir","slice","makeTokenCachePath","cachePath","cachedStr","cacheStr","DatabaseState","Permission"],"mappings":"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"}