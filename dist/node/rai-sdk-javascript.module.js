import*as e from"node-fetch";import*as t from"query-string";import*as n from"apache-arrow";import*as a from"@protobuf-ts/runtime";import*as r from"console-table-printer";import*as i from"decimal.js";import*as s from"config-ini-parser";import{createRequire as o}from"module";var l={d:(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},c={};l.d(c,{MS:()=>f,KU:()=>le,vD:()=>fe,Hh:()=>$,cN:()=>de,hi:()=>ce,mT:()=>Y,Gj:()=>q,$5:()=>pe,hY:()=>_,ZV:()=>x,y3:()=>ue,MX:()=>b,Bm:()=>O,vv:()=>S,oj:()=>R,Am:()=>W,TR:()=>U,Q_:()=>D,uU:()=>K,WG:()=>Ae,C7:()=>G,qw:()=>h,pF:()=>H,i4:()=>ie,J0:()=>re,q4:()=>T,Ge:()=>M,Ai:()=>_e,UZ:()=>ke,sK:()=>ve,xe:()=>be,zi:()=>Le,up:()=>Re});const u=(d={default:()=>e.default},p={},l.d(p,d),p);var d,p;const y=(e=>{var t={};return l.d(t,e),t})({stringify:()=>t.stringify});class f extends Error{message;status;details;response;constructor(e,t="",n="",a){super(e),this.message=e,this.status=t,this.details=n,this.response=a,this.name="ApiError"}toString(){return`${this.status}: ${this.message}\n${this.details}`}}class h extends Error{message;result;response;constructor(e,t){const n="Transaction error. See transaction result";super(n),this.name="TransactionError",this.message=n,this.response=t,this.result=e}toString(){return`${this.message}:\n ${JSON.stringify(this.result,void 0,2)}`}}const T="0.7.0",m="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;function g(e,t){const n=`rai-sdk-javascript/${T}`,a={Accept:"application/json","Content-type":"application/json"};if(m){const e=new URL(t);a.Host=e.hostname,a["User-agent"]=n}return{...a,...e}}async function E(e,t={}){const n={method:t.method||"GET",body:JSON.stringify(t.body),headers:g(t.headers,e)};"undefined"==typeof window&&(n.highWaterMark=1048576);const a=t.query&&Object.keys(t.query).length>0?`${e}?${(0,y.stringify)(t.query,{arrayFormat:"none"})}`:e,r=globalThis.fetch||u.default;let i;try{i=await r(a,n)}catch(e){const t=e.message.toLowerCase();if(t.includes("failed to fetch")||t.includes("networkerror when attempting to fetch resource"))throw new Error("Request failed due to a connectivity issue. Please check your network connection.");throw e}const s=i.headers.get("content-type");let o;const l=i.clone();try{o=s&&s.includes("application/json")?await i.json():s&&s.includes("application/x-protobuf")?await i.blob():s?.includes("multipart/form-data")&&i.body?await async function(e){const t=await e.formData(),n=[];for(const e of t)n.push({name:e[0],file:e[1]});return n}(i):await i.text()}catch(e){const t=new Error("Failed to read server response.");throw t.cause=e,t}if(t.onResponse)try{t.onResponse(l.clone())}catch{}if(i.ok)return o;throw function(e,t){return"TransactionResult"===e?.type?new h(e,t):new f(e?.message||t.statusText||t.status,e?.status||t.status,e?.details,t)}(o,l.clone())}class w{config;region;baseUrl;_onResponse;constructor(e,t="us-east"){var n,a,r;this.config=e,this.region=t,this.baseUrl=(n=e.scheme,a=e.host,r=e.port,`${n=n.replace(/[^A-Za-z]/,"")}://${a}${r?":"+r:""}`)}onResponse(e){this._onResponse=e}async request(e,t={}){const n=`${this.baseUrl}/${e}`,a=await this.config.credentials.getToken(n),r={...t,onResponse:this._onResponse};return a&&(r.headers={authorization:`Bearer ${a}`,...r.headers}),await E(n,r)}async get(e,t={}){return this.request(e,{query:t,method:"GET"})}async post(e,t){return this.request(e,{method:"POST",...t})}async put(e,t){return this.request(e,{method:"PUT",...t})}async patch(e,t){return this.request(e,{method:"PATCH",...t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}const I=(e=>{var t={};return l.d(t,e),t})({tableFromIPC:()=>n.tableFromIPC}),v=(e=>{var t={};return l.d(t,e),t})({MESSAGE_TYPE:()=>a.MESSAGE_TYPE,MessageType:()=>a.MessageType,UnknownFieldHandler:()=>a.UnknownFieldHandler,WireType:()=>a.WireType,reflectionMergePartial:()=>a.reflectionMergePartial});var b,_;!function(e){e[e.UNSPECIFIED_TYPE=0]="UNSPECIFIED_TYPE",e[e.INT_128=1]="INT_128",e[e.INT_64=2]="INT_64",e[e.INT_32=3]="INT_32",e[e.INT_16=4]="INT_16",e[e.INT_8=5]="INT_8",e[e.UINT_128=6]="UINT_128",e[e.UINT_64=7]="UINT_64",e[e.UINT_32=8]="UINT_32",e[e.UINT_16=9]="UINT_16",e[e.UINT_8=10]="UINT_8",e[e.FLOAT_64=11]="FLOAT_64",e[e.FLOAT_32=12]="FLOAT_32",e[e.FLOAT_16=13]="FLOAT_16",e[e.CHAR=14]="CHAR",e[e.BOOL=15]="BOOL",e[e.STRING=16]="STRING",e[e.SYMBOL=17]="SYMBOL",e[e.VARIABLE_SIZE_STRING=18]="VARIABLE_SIZE_STRING"}(b||(b={})),function(e){e[e.UNSPECIFIED_KIND=0]="UNSPECIFIED_KIND",e[e.PRIMITIVE_TYPE=1]="PRIMITIVE_TYPE",e[e.VALUE_TYPE=2]="VALUE_TYPE",e[e.CONSTANT_TYPE=3]="CONSTANT_TYPE"}(_||(_={}));class k extends v.MessageType{constructor(){super("relationalai.protocol.RelationId",[{no:1,name:"arguments",kind:"message",repeat:1,T:()=>W}])}create(e){const t={arguments:[]};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.arguments.push(W.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.arguments.length;a++)W.internalBinaryWrite(e.arguments[a],t.tag(1,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const D=new k;class N extends v.MessageType{constructor(){super("relationalai.protocol.RelTuple",[{no:1,name:"arguments",kind:"message",repeat:1,T:()=>O}])}create(e){const t={arguments:[]};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.arguments.push(O.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.arguments.length;a++)O.internalBinaryWrite(e.arguments[a],t.tag(1,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const R=new N;class A extends v.MessageType{constructor(){super("relationalai.protocol.RelInt128",[{no:1,name:"highbits",kind:"scalar",T:4,L:0},{no:2,name:"lowbits",kind:"scalar",T:4,L:0}])}create(e){const t={highbits:0n,lowbits:0n};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.highbits=e.uint64().toBigInt();break;case 2:r.lowbits=e.uint64().toBigInt();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0n!==e.highbits&&t.tag(1,v.WireType.Varint).uint64(e.highbits),0n!==e.lowbits&&t.tag(2,v.WireType.Varint).uint64(e.lowbits);let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const S=new A;class V extends v.MessageType{constructor(){super("relationalai.protocol.RelUInt128",[{no:1,name:"highbits",kind:"scalar",T:4,L:0},{no:2,name:"lowbits",kind:"scalar",T:4,L:0}])}create(e){const t={highbits:0n,lowbits:0n};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.highbits=e.uint64().toBigInt();break;case 2:r.lowbits=e.uint64().toBigInt();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0n!==e.highbits&&t.tag(1,v.WireType.Varint).uint64(e.highbits),0n!==e.lowbits&&t.tag(2,v.WireType.Varint).uint64(e.lowbits);let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const U=new V;class C extends v.MessageType{constructor(){super("relationalai.protocol.PrimitiveValue",[{no:1,name:"tag",kind:"enum",T:()=>["relationalai.protocol.PrimitiveType",b]},{no:2,name:"int128_val",kind:"message",oneof:"value",T:()=>S},{no:3,name:"int64_val",kind:"scalar",oneof:"value",T:3,L:0},{no:4,name:"int32_val",kind:"scalar",oneof:"value",T:5},{no:5,name:"int16_val",kind:"scalar",oneof:"value",T:5},{no:6,name:"int8_val",kind:"scalar",oneof:"value",T:5},{no:7,name:"uint128_val",kind:"message",oneof:"value",T:()=>U},{no:8,name:"uint64_val",kind:"scalar",oneof:"value",T:4,L:0},{no:9,name:"uint32_val",kind:"scalar",oneof:"value",T:13},{no:10,name:"uint16_val",kind:"scalar",oneof:"value",T:13},{no:11,name:"uint8_val",kind:"scalar",oneof:"value",T:13},{no:12,name:"float64_val",kind:"scalar",oneof:"value",T:1},{no:13,name:"float32_val",kind:"scalar",oneof:"value",T:2},{no:14,name:"float16_val",kind:"scalar",oneof:"value",T:2},{no:15,name:"char_val",kind:"scalar",oneof:"value",T:13},{no:16,name:"bool_val",kind:"scalar",oneof:"value",T:8},{no:17,name:"string_val",kind:"scalar",oneof:"value",T:12}])}create(e){const t={tag:0,value:{oneofKind:void 0}};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.tag=e.int32();break;case 2:r.value={oneofKind:"int128Val",int128Val:S.internalBinaryRead(e,e.uint32(),n,r.value.int128Val)};break;case 3:r.value={oneofKind:"int64Val",int64Val:e.int64().toBigInt()};break;case 4:r.value={oneofKind:"int32Val",int32Val:e.int32()};break;case 5:r.value={oneofKind:"int16Val",int16Val:e.int32()};break;case 6:r.value={oneofKind:"int8Val",int8Val:e.int32()};break;case 7:r.value={oneofKind:"uint128Val",uint128Val:U.internalBinaryRead(e,e.uint32(),n,r.value.uint128Val)};break;case 8:r.value={oneofKind:"uint64Val",uint64Val:e.uint64().toBigInt()};break;case 9:r.value={oneofKind:"uint32Val",uint32Val:e.uint32()};break;case 10:r.value={oneofKind:"uint16Val",uint16Val:e.uint32()};break;case 11:r.value={oneofKind:"uint8Val",uint8Val:e.uint32()};break;case 12:r.value={oneofKind:"float64Val",float64Val:e.double()};break;case 13:r.value={oneofKind:"float32Val",float32Val:e.float()};break;case 14:r.value={oneofKind:"float16Val",float16Val:e.float()};break;case 15:r.value={oneofKind:"charVal",charVal:e.uint32()};break;case 16:r.value={oneofKind:"boolVal",boolVal:e.bool()};break;case 17:r.value={oneofKind:"stringVal",stringVal:e.bytes()};break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0!==e.tag&&t.tag(1,v.WireType.Varint).int32(e.tag),"int128Val"===e.value.oneofKind&&S.internalBinaryWrite(e.value.int128Val,t.tag(2,v.WireType.LengthDelimited).fork(),n).join(),"int64Val"===e.value.oneofKind&&t.tag(3,v.WireType.Varint).int64(e.value.int64Val),"int32Val"===e.value.oneofKind&&t.tag(4,v.WireType.Varint).int32(e.value.int32Val),"int16Val"===e.value.oneofKind&&t.tag(5,v.WireType.Varint).int32(e.value.int16Val),"int8Val"===e.value.oneofKind&&t.tag(6,v.WireType.Varint).int32(e.value.int8Val),"uint128Val"===e.value.oneofKind&&U.internalBinaryWrite(e.value.uint128Val,t.tag(7,v.WireType.LengthDelimited).fork(),n).join(),"uint64Val"===e.value.oneofKind&&t.tag(8,v.WireType.Varint).uint64(e.value.uint64Val),"uint32Val"===e.value.oneofKind&&t.tag(9,v.WireType.Varint).uint32(e.value.uint32Val),"uint16Val"===e.value.oneofKind&&t.tag(10,v.WireType.Varint).uint32(e.value.uint16Val),"uint8Val"===e.value.oneofKind&&t.tag(11,v.WireType.Varint).uint32(e.value.uint8Val),"float64Val"===e.value.oneofKind&&t.tag(12,v.WireType.Bit64).double(e.value.float64Val),"float32Val"===e.value.oneofKind&&t.tag(13,v.WireType.Bit32).float(e.value.float32Val),"float16Val"===e.value.oneofKind&&t.tag(14,v.WireType.Bit32).float(e.value.float16Val),"charVal"===e.value.oneofKind&&t.tag(15,v.WireType.Varint).uint32(e.value.charVal),"boolVal"===e.value.oneofKind&&t.tag(16,v.WireType.Varint).bool(e.value.boolVal),"stringVal"===e.value.oneofKind&&t.tag(17,v.WireType.LengthDelimited).bytes(e.value.stringVal);let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const O=new C;class P extends v.MessageType{constructor(){super("relationalai.protocol.ValueType",[{no:1,name:"argument_types",kind:"message",repeat:1,T:()=>W}])}create(e){const t={argumentTypes:[]};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.argumentTypes.push(W.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.argumentTypes.length;a++)W.internalBinaryWrite(e.argumentTypes[a],t.tag(1,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const M=new P;class L extends v.MessageType{constructor(){super("relationalai.protocol.ConstantType",[{no:1,name:"rel_type",kind:"message",T:()=>W},{no:2,name:"value",kind:"message",T:()=>R}])}create(e){const t={};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.relType=W.internalBinaryRead(e,e.uint32(),n,r.relType);break;case 2:r.value=R.internalBinaryRead(e,e.uint32(),n,r.value);break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){e.relType&&W.internalBinaryWrite(e.relType,t.tag(1,v.WireType.LengthDelimited).fork(),n).join(),e.value&&R.internalBinaryWrite(e.value,t.tag(2,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const $=new L;class F extends v.MessageType{constructor(){super("relationalai.protocol.RelType",[{no:1,name:"tag",kind:"enum",T:()=>["relationalai.protocol.Kind",_]},{no:2,name:"primitive_type",kind:"enum",T:()=>["relationalai.protocol.PrimitiveType",b]},{no:3,name:"value_type",kind:"message",T:()=>M},{no:4,name:"constant_type",kind:"message",T:()=>$}])}create(e){const t={tag:0,primitiveType:0};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.tag=e.int32();break;case 2:r.primitiveType=e.int32();break;case 3:r.valueType=M.internalBinaryRead(e,e.uint32(),n,r.valueType);break;case 4:r.constantType=$.internalBinaryRead(e,e.uint32(),n,r.constantType);break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0!==e.tag&&t.tag(1,v.WireType.Varint).int32(e.tag),0!==e.primitiveType&&t.tag(2,v.WireType.Varint).int32(e.primitiveType),e.valueType&&M.internalBinaryWrite(e.valueType,t.tag(3,v.WireType.LengthDelimited).fork(),n).join(),e.constantType&&$.internalBinaryWrite(e.constantType,t.tag(4,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const W=new F;class B extends v.MessageType{constructor(){super("relationalai.protocol.MetadataInfo",[{no:1,name:"relations",kind:"message",repeat:1,T:()=>K}])}create(e){const t={relations:[]};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.relations.push(K.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.relations.length;a++)K.internalBinaryWrite(e.relations[a],t.tag(1,v.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const x=new B;class j extends v.MessageType{constructor(){super("relationalai.protocol.RelationMetadata",[{no:1,name:"relation_id",kind:"message",T:()=>D},{no:2,name:"file_name",kind:"scalar",T:9}])}create(e){const t={fileName:""};return globalThis.Object.defineProperty(t,v.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,v.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.relationId=D.internalBinaryRead(e,e.uint32(),n,r.relationId);break;case 2:r.fileName=e.string();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?v.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){e.relationId&&D.internalBinaryWrite(e.relationId,t.tag(1,v.WireType.LengthDelimited).fork(),n).join(),""!==e.fileName&&t.tag(2,v.WireType.LengthDelimited).string(e.fileName);let a=n.writeUnknownFields;return!1!==a&&(1==a?v.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const K=new j;var H,G,Y,q;async function J(e){const t=[];for(const n of e)if("string"!=typeof n.file&&"application/vnd.apache.arrow.stream"===n.file.type){const e=await(0,I.tableFromIPC)(n.file.stream());t.push({relationId:n.name,filename:n.file.name,table:e})}return t}async function z(e,t){const n=(t?.relations||[]).reduce(((e,t)=>(e[t.fileName]=t.relationId,e)),{});return e.map((e=>{const t=n[e.filename]||{arguments:[]};return{relationId:e.relationId,table:e.table,metadata:t}}))}async function Q(e){if(!e?.arrayBuffer)throw new Error("Unsupported metadata type: "+typeof e);try{const t=await e.arrayBuffer(),n=new Uint8Array(t);return x.fromBinary(n)}catch(e){if("illegal tag: field no 0 wire type 0"===e.message)return{relations:[]};throw e}}async function X(e){let t;if("string"==typeof e)t=e;else{const n=await e.arrayBuffer();t=(new TextDecoder).decode(n)}return JSON.parse(t)}!function(e){e.OPEN="OPEN",e.CREATE="CREATE",e.CREATE_OVERWRITE="CREATE_OVERWRITE",e.OPEN_OR_CREATE="OPEN_OR_CREATE",e.CLONE="CLONE",e.CLONE_OVERWRITE="CLONE_OVERWRITE"}(H||(H={})),function(e){e.CREATED="CREATED",e.RUNNING="RUNNING",e.CANCELLING="CANCELLING",e.ABORTED="ABORTED",e.COMPLETED="COMPLETED"}(G||(G={}));class Z extends w{async runTransaction(e,t,n,a=H.OPEN){const r={dbname:e,compute_name:t,open_mode:a,region:this.region};return await this.post("transaction",{query:r,body:n})}async runActions(e,t,n,a=!0){const r=n.map(((e,t)=>function(e,t){return{type:"LabeledAction",name:e,action:t}}(`action-${t}`,e))),i={type:"Transaction",abort:!1,dbname:e,mode:H.OPEN,nowait_durable:!1,readonly:a,version:0,actions:r,computeName:t};return await this.runTransaction(e,t,i)}}!function(e){e.XS="XS",e.S="S",e.M="M",e.L="L",e.XL="XL"}(Y||(Y={})),function(e){e.REQUESTED="REQUESTED",e.PROVISIONING="PROVISIONING",e.REGISTERING="REGISTERING",e.PROVISIONED="PROVISIONED",e.PROVISION_FAILED="PROVISION_FAILED",e.DELETE_REQUESTED="DELETE_REQUESTED",e.STOPPING="STOPPING",e.DELETING="DELETING",e.DELETED="DELETED",e.DELETION_FAILED="DELETION_FAILED"}(q||(q={}));class ee extends w{async runTransactionAsync(e){const t=await this.post("transactions",{body:e});return Array.isArray(t)?await async function(e){const t=e.find((e=>"transaction"===e.name)),n=e.find((e=>"problems"===e.name)),a=e.find((e=>"metadata.proto"===e.name));if(!t)throw new Error("transaction part not found");const r=a?await Q(a.file):void 0,i={transaction:await X(t.file),results:await z(await J(e),r)};return n&&(i.problems=await X(n.file)),i}(t):{transaction:t}}async listTransactions(e){return(await this.get("transactions",e)).transactions}async getTransaction(e){return(await this.get(`transactions/${e}`)).transaction}async getTransactionResults(e){const t=await this.get(`transactions/${e}/results`);return await J(t)}async getTransactionMetadata(e){return Q(await this.request(`transactions/${e}/metadata`,{method:"GET",headers:{Accept:"application/x-protobuf"}}))}async getTransactionProblems(e){return await this.get(`transactions/${e}/problems`)}async cancelTransaction(e){return await this.post(`transactions/${e}/cancel`,{})||{}}}function te(e,t,n=e){return{type:"Source",name:e,value:t,path:n}}const ne=(e,t)=>({rel_key:{values:[],name:e,keys:["RAI_VariableSizeStrings.VariableSizeString"],type:"RelKey"},type:"Relation",columns:[[t]]});function ae(e){return"string"==typeof e?1===e.length?`'${e.replace(/'/g,"\\'")}'`:`"${e.replace(/"/g,'\\"')}"`:"number"==typeof e?e:"boolean"==typeof e?e?"true":"false":void 0}var re,ie,se;!function(e){e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE"}(re||(re={})),function(e){e.USER="user",e.ADMIN="admin"}(ie||(ie={}));class oe extends w{}se=oe,[class extends w{async createDatabase(e,t){return(await this.put("database",{body:{name:e,source_name:t}})).database}async listDatabases(e){return(await this.get("database",e)).databases}async getDatabase(e){return(await this.listDatabases({name:e}))[0]}async deleteDatabase(e){return await this.delete("database",{body:{name:e}})}},class extends Z{async listEdbs(e,t){const n=await this.runActions(e,t,[{type:"ListEdbAction"}]);if("ListEdbActionResult"===n.actions[0]?.result?.type)return n.actions[0].result.rels;throw new Error("ListEdbActionResult is missing")}async deleteEdb(e,t,n){const a={type:"ModifyWorkspaceAction",delete_edb:n},r=await this.runActions(e,t,[a],!1);if("ModifyWorkspaceActionResult"===r.actions[0]?.result?.type)return r.actions[0].result.delete_edb_result;throw new Error("ModifyWorkspaceActionResult is missing")}},class extends w{async createEngine(e,t=Y.XS){return(await this.put("compute",{body:{region:this.region,name:e,size:t}})).compute}async listEngines(e){return(await this.get("compute",e)).computes}async getEngine(e){return(await this.listEngines({name:e}))[0]}async deleteEngine(e){return(await this.delete("compute",{body:{name:e}})).status}},class extends Z{async installModels(e,t,n){const a={type:"InstallAction",sources:n};return await this.runActions(e,t,[a],!1)}async listModels(e,t){return await this.runActions(e,t,[{type:"ListSourceAction"}])}async getModel(e,t,n){const a=await this.listModels(e,t);if("ListSourceActionResult"===a.actions[0]?.result?.type){const e=a.actions[0].result.sources.find((e=>e.name===n));if(e)return e}throw new Error(`Model '${n}' not found`)}async deleteModel(e,t,n){const a={type:"ModifyWorkspaceAction",delete_source:[n]},r=await this.runActions(e,t,[a],!1);if("ModifyWorkspaceActionResult"===r.actions[0]?.result?.type)return r.actions[0].result;throw new Error("ModifyWorkspaceActionResult is missing")}},class extends w{async createOAuthClient(e,t){return(await this.post("oauth-clients",{body:{name:e,permissions:t}})).client}async listOAuthClients(){return(await this.get("oauth-clients")).clients}async getOAuthClient(e){return(await this.get(`oauth-clients/${e}`)).client}async updateOAuthClient(e,t,n){const a={};return t&&(a.name=t),n&&(a.permissions=n),(await this.patch(`oauth-clients/${e}`,{body:a})).client}async rotateOAuthClientSecret(e){return(await this.post(`oauth-clients/${e}/rotate-secret`,{})).client}async deleteOAuthClient(e){return await this.delete(`oauth-clients/${e}`,{})}async listPermissions(){return(await this.get("permissions",{})).permissions}},class extends ee{async execAsync(e,t,n,a=[],r=!0,i=[]){const s={dbname:e,query:n,nowait_durable:!1,readonly:r,v1_inputs:a.map((e=>ne(e.name,e.value))),tags:i};return t&&(s.engine_name=t),await this.runTransactionAsync(s)}async exec(e,t,n,a=[],r=!0,i=[],s=1e3,o=Number.POSITIVE_INFINITY){const l=await this.execAsync(e,t,n,a,r,i),c=l.transaction.id;return"results"in l?l:await this.pollTransaction(c,s,o)}async pollTransaction(e,t=1e3,n=Number.POSITIVE_INFINITY){const a=Date.now();let r;await new Promise(((i,s)=>{const o=()=>{setTimeout((async()=>{var t;r=await this.getTransaction(e),(t=r.state)===G.ABORTED||t===G.COMPLETED?i():(Date.now()-a>n&&s(new Error(`Polling transaction timeout of ${n}ms has been exceeded.`)),o())}),t)};o()}));const i=await Promise.all([this.getTransactionMetadata(e),this.getTransactionProblems(e),this.getTransactionResults(e)]),s=await z(i[2],i[0]);return{transaction:r,problems:i[1],results:s}}},class extends Z{async query(e,t,n,a=[],r=!0){const i=function(e,t=[]){return{type:"QueryAction",outputs:[],persist:[],source:te("query",e,""),inputs:t.map((e=>ne(e.name,e.value)))}}(n,a);return await this.runActions(e,t,[i],r)}async loadJson(e,t,n,a){const r=["def config:data = data",`def insert:${n} = load_json[config]`],i=[{name:"data",value:JSON.stringify(a)}];return this.query(e,t,r.join("\n"),i,!1)}async loadCsv(e,t,n,a,r,i){const s=["def config:data = data"],o=[{name:"data",value:a}];return r&&s.push(...function(e){const t=[];return Object.keys(e).forEach((n=>{const a=n;if("header"===a){const n=Object.keys(e.header).map((t=>`(${t}, ${ae(e.header[t])})`)).join("; ");t.push(`def config:syntax:header = ${n}`)}else t.push(`def config:syntax:${a} = ${ae(e[a])}`)})),t}(r)),i&&s.push(...function(e){const t=[];return Object.keys(e).forEach((n=>{t.push(`def config:schema${n} = ${ae(e[n])}`)})),t}(i)),s.push(`def insert:${n} = load_csv[config]`),this.query(e,t,s.join("\n"),o,!1)}},Z,ee,class extends w{async createUser(e,t){return(await this.post("users",{body:{email:e,roles:t}})).user}async listUsers(){return(await this.get("users")).users}async getUser(e){return(await this.get(`users/${e}`)).user}async updateUser(e,t,n){const a={};return t&&(a.status=t),n&&n.length&&(a.roles=n),(await this.patch(`users/${e}`,{body:a})).user}async enableUser(e){return await this.updateUser(e,re.ACTIVE)}async disableUser(e){return await this.updateUser(e,re.INACTIVE)}async deleteUser(e){return await this.delete(`users/${e}`,{})}}].forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((t=>{Object.defineProperty(se.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))}))}));const le=oe;var ce,ue;!function(e){e.CREATED="CREATED",e.CREATING="CREATING",e.CREATION_FAILED="CREATION_FAILED",e.DELETED="DELETED"}(ce||(ce={})),function(e){e.CREATE_COMPUTE="create:compute",e.DELETE_COMPUTE="delete:compute",e.LIST_COMPUTES="list:compute",e.READ_COMPUTE="read:compute",e.CREATE_DATABASE="create:database",e.LIST_DATABASES="list:database",e.UPDATE_DATABASE="update:database",e.DELETE_DATABASE="delete:database",e.RUN_TRANSACTION="run:transaction",e.LIST_TRANSACTION="list:transaction",e.DELETE_TRANSACTION="delete:transaction",e.READ_TRANSACTION="read:transaction",e.READ_CREDITS_USAGE="read:credits_usage",e.CREATE_OAUTH_CLIENT="create:oauth_client",e.READ_OAUTH_CLIENT="read:oauth_client",e.LIST_OAUTH_CLIENTS="list:oauth_client",e.UPDATE_OAUTH_CLIENT="update:oauth_client",e.DELETE_OAUTH_CLIENT="delete:oauth_client",e.ROTATE_OAUTH_CLIENT_SECRET="rotate:oauth_client_secret",e.CREATE_USER="create:user",e.LIST_USERS="list:user",e.READ_USER="read:user",e.UPDATE_USER="update:user",e.DELETE_USER="delete:user",e.LIST_ROLES="list:role",e.READ_ROLE="read:role",e.LIST_PERMISSIONS="list:permission",e.CREATE_ACCESS_KEY="create:accesskey",e.LIST_ACCESS_KEYS="list:accesskey"}(ue||(ue={}));class de{}class pe extends de{getToken;constructor(e){super(),this.getToken=e}}class ye{token;experiesIn;createdOn;constructor(e,t,n){this.token=e,this.experiesIn=t,this.createdOn=n}get isExpired(){return(Date.now()-this.createdOn)/1e3>=this.experiesIn}}class fe extends de{readCache;writeCache;clientId;clientSecret;clientCredentialsUrl;accessToken;constructor(e,t,n,a,r){super(),this.readCache=a,this.writeCache=r,this.clientId=e,this.clientSecret=t,this.clientCredentialsUrl=n}async getToken(e){return await this.readTokenFromCache(),this.accessToken&&!this.accessToken.isExpired?this.accessToken.token:this.requestToken(e)}async readTokenFromCache(){if(!this.accessToken&&this.readCache){const e=await this.readCache();e&&(this.accessToken=new ye(e.access_token,e.expires_in,e.created_on))}}async requestToken(e){const t=new URL(e),n={client_id:this.clientId,client_secret:this.clientSecret,grant_type:"client_credentials",audience:`https://${t.hostname}`},a=await E(this.clientCredentialsUrl,{method:"POST",body:n}),r={access_token:a.access_token,expires_in:a.expires_in,created_on:Date.now()};return this.accessToken=new ye(r.access_token,r.expires_in,r.created_on),this.writeCache&&await this.writeCache(r),this.accessToken.token}}const he=(e=>{var t={};return l.d(t,e),t})({Table:()=>r.Table}),Te=(e=>{var t={};return l.d(t,e),t})({default:()=>i.default});Te.default.config({precision:31});const me=/^Int(\d+)$/,ge=/^UInt(\d+)$/,Ee=/^Float(\d+)$/,we=/^FixedPointDecimals.FixedDecimal{Int(\d+), (\d+)}$/,Ie=/^Rational{Int(\d+)}$/;function ve(e){if(e.startsWith(":"))return{type:"Constant",name:"Symbol",value:{type:"String",value:e}};if(e.includes("(")&&!e.startsWith("("))return{type:"Constant",name:e,value:{type:"String",value:e}};if("String"===e)return{type:"String"};if("Bool"===e)return{type:"Bool"};if("Char"===e)return{type:"Char"};if("Dates.DateTime"===e)return{type:"DateTime"};if("Dates.Date"===e)return{type:"Date"};if("Dates.Year"===e)return{type:"Year"};if("Dates.Month"===e)return{type:"Month"};if("Dates.Week"===e)return{type:"Week"};if("Dates.Day"===e)return{type:"Day"};if("Dates.Hour"===e)return{type:"Hour"};if("Dates.Minute"===e)return{type:"Minute"};if("Dates.Second"===e)return{type:"Second"};if("Dates.Millisecond"===e)return{type:"Millisecond"};if("Dates.Microsecond"===e)return{type:"Microsecond"};if("Dates.Nanosecond"===e)return{type:"Nanosecond"};if("HashValue"===e)return{type:"Hash"};if("Missing"===e)return{type:"Missing"};if("FilePos"===e)return{type:"FilePos"};const t=e.match(me);if(t&&2===t.length)return{type:`Int${t[1]}`};const n=e.match(ge);if(n&&2===n.length)return{type:`UInt${n[1]}`};const a=e.match(Ee);if(a&&2===a.length)return{type:`Float${a[1]}`};const r=e.match(we);if(r&&3===r.length)return{type:`Decimal${Number.parseInt(r[1])}`,places:Number.parseInt(r[2])};const i=e.match(Ie);return i&&2===i.length?{type:`Rational${i[1]}`}:{type:"Unknown",name:e}}function be(e){if(e.tag===_.CONSTANT_TYPE&&e.constantType?.value&&e.constantType?.relType){const t=be(e.constantType.relType);if("ValueType"!==t.type){const n=e.constantType.value.arguments.map(Ne),a=_e(t,1===n.length?n[0]:n);return{type:"Constant",name:"String"===t.type?"Symbol":`${t.type}(${ke(t,a)})`,value:{...t,value:a}}}{const n=Re(t,e.constantType.value.arguments);return{type:"Constant",name:`${t.type}(${ke(t,n)})`,value:{...t,value:_e(t,n)}}}}if(e.tag===_.PRIMITIVE_TYPE)switch(e.primitiveType){case b.SYMBOL:case b.STRING:return{type:"String"};case b.CHAR:return{type:"Char"};case b.BOOL:return{type:"Bool"};case b.INT_8:return{type:"Int8"};case b.INT_16:return{type:"Int16"};case b.INT_32:return{type:"Int32"};case b.INT_64:return{type:"Int64"};case b.INT_128:return{type:"Int128"};case b.UINT_8:return{type:"UInt8"};case b.UINT_16:return{type:"UInt16"};case b.UINT_32:return{type:"UInt32"};case b.UINT_64:return{type:"UInt64"};case b.UINT_128:return{type:"UInt128"};case b.FLOAT_16:return{type:"Float16"};case b.FLOAT_32:return{type:"Float32"};case b.FLOAT_64:return{type:"Float64"}}return e.tag===_.VALUE_TYPE&&e.valueType?function(e){const t=e.typeDefs.slice(0,3).filter((e=>"Constant"===e.type&&"String"===e.value.type));if(3!==t.length||":rel"!==t[0].value.value||":base"!==t[1].value.value)return e;const n=t[2].value.value.slice(1);switch(n){case"DateTime":case"Date":case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"FilePos":case"Missing":case"Hash":return{type:n};case"FixedDecimal":if(6===e.typeDefs.length&&"Constant"===e.typeDefs[3].type&&"Constant"===e.typeDefs[4].type){const t=Number(e.typeDefs[3].value.value),n=Number(e.typeDefs[4].value.value);if(16===t||32===t||64===t||128===t)return{type:`Decimal${t}`,places:n}}break;case"Rational":if(4===e.typeDefs.length&&"ValueType"===e.typeDefs[3].type){const t=e.typeDefs[3];if(2===t.typeDefs.length)switch(t.typeDefs[0].type){case"Int8":return{type:"Rational8"};case"Int16":return{type:"Rational16"};case"Int32":return{type:"Rational32"};case"Int64":return{type:"Rational64"};case"Int128":return{type:"Rational128"}}}}return e}({type:"ValueType",typeDefs:e.valueType.argumentTypes.map((e=>be(e)))}):{type:"Unknown"}}function _e(e,t){switch(e.type){case"String":case"Bool":case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"FilePos":case"Int8":case"Int16":case"Int32":case"Int64":case"UInt8":case"UInt16":case"UInt32":case"UInt64":case"Float16":case"Float32":case"Float64":return t;case"Char":return String.fromCodePoint(t);case"DateTime":return new Date(Number(t)-621356832e5);case"Date":return new Date(864e5*Number(t)-621356832e5);case"Missing":return null;case"Hash":case"UInt128":return n=Array.from(t),BigInt.asUintN(64,n[1])<<BigInt(64)|n[0];case"Int128":return De(Array.from(t));case"Decimal16":case"Decimal32":case"Decimal64":return new Te.default(t.toString()).dividedBy(Math.pow(10,e.places));case"Decimal128":{const n=De(Array.from(t));return new Te.default(n.toString()).dividedBy(Math.pow(10,e.places))}case"Rational8":case"Rational16":case"Rational32":case"Rational64":return{numerator:(t=Array.from(t))[0],denominator:t[1]};case"Rational128":return t=Array.from(t),{numerator:De(Array.from(t[0])),denominator:De(Array.from(t[1]))};case"Constant":return e.value.value;case"ValueType":{const n=e.typeDefs.filter((e=>"Constant"!==e.type));let a=t?.toArray?t.toArray():t;return 1===n.length&&(a=[a]),n.map(((e,t)=>_e(e,a[t])))}case"Unknown":return t&&t.toJSON?t.toJSON():t}var n}function ke(e,t){const n={...e,value:t};if("Constant"===e.type)return ke(e.value,t);switch(n.type){case"String":return JSON.stringify(n.value).slice(1,-1);case"Bool":return n.value?"true":"false";case"Char":return n.value;case"DateTime":return n.value.toISOString();case"Date":return n.value.toISOString().split("T")[0];case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"Int8":case"Int16":case"Int32":case"Int64":case"Int128":case"UInt8":case"UInt16":case"UInt32":case"UInt64":case"UInt128":case"FilePos":case"Hash":return n.value.toString();case"Missing":return"missing";case"Float16":case"Float32":case"Float64":return n.value%1==0?n.value+".0":n.value.toString();case"Decimal16":case"Decimal32":case"Decimal64":case"Decimal128":return n.value.toFixed(n.places);case"Rational8":case"Rational16":case"Rational32":case"Rational64":case"Rational128":return`${n.value.numerator}/${n.value.denominator}`;case"ValueType":return n.typeDefs.filter((e=>"Constant"!==e.type)).map(((e,t)=>{const a=ke(e,n.value[t]);return"ValueType"===e.type?`(${a})`:a})).join(", ");case"Unknown":{const e=n.value;return"object"==typeof e?Object.keys(e).map((t=>`${e[t]}`)).join(", "):e}}}function De(e){return BigInt.asIntN(64,e[1])<<BigInt(64)|e[0]}function Ne(e){switch(e.value.oneofKind){case"stringVal":return`:${(new TextDecoder).decode(e.value.stringVal)}`;case"charVal":return e.value.charVal;case"boolVal":return e.value.boolVal;case"int8Val":return e.value.int8Val;case"int16Val":return e.value.int16Val;case"int32Val":return e.value.int32Val;case"int64Val":return e.value.int64Val;case"int128Val":return[e.value.int128Val.lowbits,e.value.int128Val.highbits];case"uint8Val":return e.value.uint8Val;case"uint16Val":return e.value.uint16Val;case"uint32Val":return e.value.uint32Val;case"uint64Val":return e.value.uint64Val;case"uint128Val":return[e.value.uint128Val.lowbits,e.value.uint128Val.highbits];case"float16Val":return e.value.float16Val;case"float32Val":return e.value.float32Val;case"float64Val":return e.value.float64Val}throw new Error("Unknown primitive value")}function Re(e,t){const n=t.map(Ne),a=[],r=(e,t)=>{if("ValueType"===e.type){const n=[];t.push(n),e.typeDefs.forEach((e=>r(e,n)))}else"Constant"!==e.type&&t.push(n.splice(0,1)[0])};return r(e,a),a[0]}class Ae{relation;table;colDefs;constructor(e){this.relation=e,this.table=e.table;const t=e.metadata.arguments.filter((e=>e.tag!==_.UNSPECIFIED_KIND)).length?e.metadata.arguments:e.relationId.split("/").filter((e=>e));let n=0;this.colDefs=t.map((e=>{const t="string"==typeof e?ve(e):be(e),a={typeDef:t,metadata:"object"==typeof e?e:{tag:_.UNSPECIFIED_KIND,primitiveType:b.UNSPECIFIED_TYPE}};return"Constant"!==t.type&&(a.arrowIndex=n,n++),a}))}typeDefs(){return this.colDefs.map((e=>e.typeDef))}get columnLength(){return this.colDefs.length}columns(){const e=[];for(let t=0;t<this.columnLength;t++)e.push(this.columnAt(t));return e}columnAt(e){const t=this.colDefs[e];if(!t)throw new Error("Couldn't find column by index");const n=this.table,a=Ve(this.colDefs)?1:this.table.numRows,r={get length(){return a},get typeDef(){return t.typeDef},*[Symbol.iterator](){if("Constant"===t.typeDef.type)for(let e=0;e<a;e++)yield _e(t.typeDef,null);else{const e=n.getChildAt(t.arrowIndex);if(!e)throw new Error("Couldn't find column by index");for(const n of e)yield _e(t.typeDef,n)}},values(){return Array.from(this)},get(e){if(!(e<0||e>=a)){if("Constant"===t.typeDef.type)return _e(t.typeDef,null);{const a=n.getChildAt(t.arrowIndex);return _e(t.typeDef,a.get(e))}}}};return r}sliceColumns(e,t){const n=this.colDefs.slice(e,t),a=[];n.forEach((e=>{void 0!==e.arrowIndex&&a.push(this.table.schema.names[e.arrowIndex])}));const r=this.relation.relationId.split("/").filter((e=>e)).slice(e,t).join("/"),i=this.table.select(a);return new Ae({relationId:`/${r}`,table:i,metadata:{arguments:n.map((e=>e.metadata))}})}get length(){return Ve(this.colDefs)?1:this.table.numRows}*[Symbol.iterator](){Ve(this.colDefs)&&(yield this.get(0));for(const e of this.table)yield Se(e,this.colDefs)}values(){return Array.from(this)}get(e){if(Ve(this.colDefs)&&0===e)return this.colDefs.map((e=>_e(e.typeDef,null)));const t=this.table.get(e);return t?Se(t,this.colDefs):void 0}slice(e,t){const n=this.table.slice(e,t);return new Ae({relationId:this.relation.relationId,table:n,metadata:this.relation.metadata})}print(){const e=new he.Table({columns:this.colDefs.map(((e,t)=>({name:t.toString(),title:e.typeDef.name||e.typeDef.type})))});this.values().forEach((t=>{const n={};t.forEach(((e,t)=>{const{typeDef:a}=this.colDefs[t];n[t]=ke(a,e)})),e.addRow(n)})),e.printTable()}physical(){const e=this.relation.relationId.split("/").filter((e=>e.length&&"Constant"!==ve(e).type)).join("/");return new Ae({relationId:`/${e}`,table:this.table,metadata:{arguments:this.colDefs.filter((e=>"Constant"!==e.typeDef.type)).map((e=>e.metadata))}})}arrow(){return this.table}}function Se(e,t){const n=e.toArray();return t.map((e=>"Constant"===e.typeDef.type?_e(e.typeDef,null):_e(e.typeDef,n[e.arrowIndex])))}function Ve(e){return e.length&&e.every((e=>"Constant"===e.typeDef.type))}const Ue=(e=>{var t={};return l.d(t,e),t})({ConfigIniParser:()=>s.ConfigIniParser}),Ce=o(import.meta.url)("fs"),Oe=o(import.meta.url)("os"),{readFile:Pe,writeFile:Me}=Ce.promises;async function Le(e="default",t="~/.rai/config"){t=Fe(t);try{const n=await Pe(t,"utf-8"),a=new Ue.ConfigIniParser;if(a.parse(n),!a.isHaveSection(e))throw new Error(`Profile '${e}' not found in ${t}`);return function(e,t){for(const n of $e)if(!e.get(t,n,""))throw new Error(`Can't find ${n} field in ${t} profile`);return{host:e.get(t,"host",""),port:e.get(t,"port","443"),scheme:e.get(t,"scheme","https"),credentials:new fe(e.get(t,"client_id",""),e.get(t,"client_secret",""),e.get(t,"client_credentials_url","https://login.relationalai.com/oauth/token"),(async()=>await async function(e="default"){const t=We(e);try{const e=await Pe(t,"utf-8"),n=JSON.parse(e);if(n.access_token&&n.created_on&&n.expires_in)return n}catch{}}(t)),(async e=>await async function(e,t="default"){const n=We(t),a=JSON.stringify(e,null,2);await Me(n,a,"utf-8")}(e,t)))}}(a,e)}catch(e){throw function(e){return e instanceof Error}(e)&&"ENOENT"===e.code?new Error(`Can't find file: ${t}`):e}}const $e=["host","client_id","client_secret"];function Fe(e){return e.startsWith("~/")?`${(0,Oe.homedir)()}/${e.slice(2)}`:e}function We(e){return Fe(`~/.rai/${e}_cache.json`)}var Be=c.MS,xe=c.KU,je=c.vD,Ke=c.Hh,He=c.cN,Ge=c.hi,Ye=c.mT,qe=c.Gj,Je=c.$5,ze=c.hY,Qe=c.ZV,Xe=c.y3,Ze=c.MX,et=c.Bm,tt=c.vv,nt=c.oj,at=c.Am,rt=c.TR,it=c.Q_,st=c.uU,ot=c.WG,lt=c.C7,ct=c.qw,ut=c.pF,dt=c.i4,pt=c.J0,yt=c.q4,ft=c.Ge,ht=c.Ai,Tt=c.UZ,mt=c.sK,gt=c.xe,Et=c.zi,wt=c.up;export{Be as ApiError,xe as Client,je as ClientCredentials,Ke as ConstantType,He as Credentials,Ge as DatabaseState,Ye as EngineSize,qe as EngineState,Je as GetTokenCredentials,ze as Kind,Qe as MetadataInfo,Xe as Permission,Ze as PrimitiveType,et as PrimitiveValue,tt as RelInt128,nt as RelTuple,at as RelType,rt as RelUInt128,it as RelationId,st as RelationMetadata,ot as ResultTable,lt as TransactionAsyncState,ct as TransactionError,ut as TransactionMode,dt as UserRole,pt as UserStatus,yt as VERSION,ft as ValueType,ht as convertValue,Tt as getDisplayValue,mt as getTypeDef,gt as getTypeDefFromProtobuf,Et as readConfig,wt as unflattenContantValue};
//# sourceMappingURL=rai-sdk-javascript.module.js.map