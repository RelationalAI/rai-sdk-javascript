(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ApiError:()=>i,Client:()=>re,ClientCredentials:()=>ue,ConstantType:()=>S,Credentials:()=>oe,DatabaseState:()=>ie,EngineSize:()=>F,EngineState:()=>W,GetTokenCredentials:()=>le,Kind:()=>T,MetadataInfo:()=>O,Permission:()=>se,PrimitiveType:()=>f,PrimitiveValue:()=>D,RelInt128:()=>v,RelTuple:()=>w,RelType:()=>U,RelUInt128:()=>_,RelationId:()=>g,RelationMetadata:()=>L,ResultTable:()=>Ne,TransactionAsyncState:()=>M,TransactionError:()=>s,TransactionMode:()=>$,UserRole:()=>ee,UserStatus:()=>Z,VERSION:()=>o,ValueType:()=>R,convertValue:()=>ve,getDisplayValue:()=>be,getTypeDef:()=>we,getTypeDefFromProtobuf:()=>Ie,readConfig:()=>Pe,unflattenContantValue:()=>De});const n=require("node-fetch-commonjs");var a=e.n(n);const r=require("query-string");class i extends Error{message;status;details;response;constructor(e,t="",n="",a){super(e),this.message=e,this.status=t,this.details=n,this.response=a,this.name="ApiError"}toString(){return`${this.status}: ${this.message}\n${this.details}`}}class s extends Error{message;result;response;constructor(e,t){const n="Transaction error. See transaction result";super(n),this.name="TransactionError",this.message=n,this.response=t,this.result=e}toString(){return`${this.message}:\n ${JSON.stringify(this.result,void 0,2)}`}}const o="0.7.0",l="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;function c(e,t){const n=`rai-sdk-javascript/${o}`,a={Accept:"application/json","Content-type":"application/json"};if(l){const e=new URL(t);a.Host=e.hostname,a["User-agent"]=n}return{...a,...e}}async function u(e,t={}){const n={method:t.method||"GET",body:JSON.stringify(t.body),headers:c(t.headers,e)};"undefined"==typeof window&&(n.highWaterMark=1048576);const o=t.query&&Object.keys(t.query).length>0?`${e}?${(0,r.stringify)(t.query,{arrayFormat:"none"})}`:e,l=globalThis.fetch||a();let u;try{u=await l(o,n)}catch(e){const t=e.message.toLowerCase();if(t.includes("failed to fetch")||t.includes("networkerror when attempting to fetch resource"))throw new Error("Request failed due to a connectivity issue. Please check your network connection.");throw e}const d=u.headers.get("content-type");let p;const y=u.clone();try{p=d&&d.includes("application/json")?await u.json():d&&d.includes("application/x-protobuf")?await u.blob():d?.includes("multipart/form-data")&&u.body?await async function(e){const t=await e.formData(),n=[];for(const e of t)n.push({name:e[0],file:e[1]});return n}(u):await u.text()}catch(e){const t=new Error("Failed to read server response.");throw t.cause=e,t}if(t.onResponse)try{t.onResponse(y.clone())}catch{}if(u.ok)return p;throw function(e,t){return"TransactionResult"===e?.type?new s(e,t):new i(e?.message||t.statusText||t.status,e?.status||t.status,e?.details,t)}(p,y.clone())}class d{config;region;baseUrl;_onResponse;constructor(e,t="us-east"){var n,a,r;this.config=e,this.region=t,this.baseUrl=(n=e.scheme,a=e.host,r=e.port,`${n=n.replace(/[^A-Za-z]/,"")}://${a}${r?":"+r:""}`)}onResponse(e){this._onResponse=e}async request(e,t={}){const n=`${this.baseUrl}/${e}`,a=await this.config.credentials.getToken(n),r={...t,onResponse:this._onResponse};return a&&(r.headers={authorization:`Bearer ${a}`,...r.headers}),await u(n,r)}async get(e,t={}){return this.request(e,{query:t,method:"GET"})}async post(e,t){return this.request(e,{method:"POST",...t})}async put(e,t){return this.request(e,{method:"PUT",...t})}async patch(e,t){return this.request(e,{method:"PATCH",...t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}const p="database",y=require("apache-arrow"),h=require("@protobuf-ts/runtime");var f,T;!function(e){e[e.UNSPECIFIED_TYPE=0]="UNSPECIFIED_TYPE",e[e.INT_128=1]="INT_128",e[e.INT_64=2]="INT_64",e[e.INT_32=3]="INT_32",e[e.INT_16=4]="INT_16",e[e.INT_8=5]="INT_8",e[e.UINT_128=6]="UINT_128",e[e.UINT_64=7]="UINT_64",e[e.UINT_32=8]="UINT_32",e[e.UINT_16=9]="UINT_16",e[e.UINT_8=10]="UINT_8",e[e.FLOAT_64=11]="FLOAT_64",e[e.FLOAT_32=12]="FLOAT_32",e[e.FLOAT_16=13]="FLOAT_16",e[e.CHAR=14]="CHAR",e[e.BOOL=15]="BOOL",e[e.STRING=16]="STRING",e[e.SYMBOL=17]="SYMBOL",e[e.VARIABLE_SIZE_STRING=18]="VARIABLE_SIZE_STRING"}(f||(f={})),function(e){e[e.UNSPECIFIED_KIND=0]="UNSPECIFIED_KIND",e[e.PRIMITIVE_TYPE=1]="PRIMITIVE_TYPE",e[e.VALUE_TYPE=2]="VALUE_TYPE",e[e.CONSTANT_TYPE=3]="CONSTANT_TYPE"}(T||(T={}));class m extends h.MessageType{constructor(){super("relationalai.protocol.RelationId",[{no:1,name:"arguments",kind:"message",repeat:1,T:()=>U}])}create(e){const t={arguments:[]};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.arguments.push(U.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.arguments.length;a++)U.internalBinaryWrite(e.arguments[a],t.tag(1,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const g=new m;class E extends h.MessageType{constructor(){super("relationalai.protocol.RelTuple",[{no:1,name:"arguments",kind:"message",repeat:1,T:()=>D}])}create(e){const t={arguments:[]};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.arguments.push(D.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.arguments.length;a++)D.internalBinaryWrite(e.arguments[a],t.tag(1,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const w=new E;class I extends h.MessageType{constructor(){super("relationalai.protocol.RelInt128",[{no:1,name:"highbits",kind:"scalar",T:4,L:0},{no:2,name:"lowbits",kind:"scalar",T:4,L:0}])}create(e){const t={highbits:0n,lowbits:0n};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.highbits=e.uint64().toBigInt();break;case 2:r.lowbits=e.uint64().toBigInt();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0n!==e.highbits&&t.tag(1,h.WireType.Varint).uint64(e.highbits),0n!==e.lowbits&&t.tag(2,h.WireType.Varint).uint64(e.lowbits);let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const v=new I;class b extends h.MessageType{constructor(){super("relationalai.protocol.RelUInt128",[{no:1,name:"highbits",kind:"scalar",T:4,L:0},{no:2,name:"lowbits",kind:"scalar",T:4,L:0}])}create(e){const t={highbits:0n,lowbits:0n};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.highbits=e.uint64().toBigInt();break;case 2:r.lowbits=e.uint64().toBigInt();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0n!==e.highbits&&t.tag(1,h.WireType.Varint).uint64(e.highbits),0n!==e.lowbits&&t.tag(2,h.WireType.Varint).uint64(e.lowbits);let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const _=new b;class k extends h.MessageType{constructor(){super("relationalai.protocol.PrimitiveValue",[{no:1,name:"tag",kind:"enum",T:()=>["relationalai.protocol.PrimitiveType",f]},{no:2,name:"int128_val",kind:"message",oneof:"value",T:()=>v},{no:3,name:"int64_val",kind:"scalar",oneof:"value",T:3,L:0},{no:4,name:"int32_val",kind:"scalar",oneof:"value",T:5},{no:5,name:"int16_val",kind:"scalar",oneof:"value",T:5},{no:6,name:"int8_val",kind:"scalar",oneof:"value",T:5},{no:7,name:"uint128_val",kind:"message",oneof:"value",T:()=>_},{no:8,name:"uint64_val",kind:"scalar",oneof:"value",T:4,L:0},{no:9,name:"uint32_val",kind:"scalar",oneof:"value",T:13},{no:10,name:"uint16_val",kind:"scalar",oneof:"value",T:13},{no:11,name:"uint8_val",kind:"scalar",oneof:"value",T:13},{no:12,name:"float64_val",kind:"scalar",oneof:"value",T:1},{no:13,name:"float32_val",kind:"scalar",oneof:"value",T:2},{no:14,name:"float16_val",kind:"scalar",oneof:"value",T:2},{no:15,name:"char_val",kind:"scalar",oneof:"value",T:13},{no:16,name:"bool_val",kind:"scalar",oneof:"value",T:8},{no:17,name:"string_val",kind:"scalar",oneof:"value",T:12}])}create(e){const t={tag:0,value:{oneofKind:void 0}};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.tag=e.int32();break;case 2:r.value={oneofKind:"int128Val",int128Val:v.internalBinaryRead(e,e.uint32(),n,r.value.int128Val)};break;case 3:r.value={oneofKind:"int64Val",int64Val:e.int64().toBigInt()};break;case 4:r.value={oneofKind:"int32Val",int32Val:e.int32()};break;case 5:r.value={oneofKind:"int16Val",int16Val:e.int32()};break;case 6:r.value={oneofKind:"int8Val",int8Val:e.int32()};break;case 7:r.value={oneofKind:"uint128Val",uint128Val:_.internalBinaryRead(e,e.uint32(),n,r.value.uint128Val)};break;case 8:r.value={oneofKind:"uint64Val",uint64Val:e.uint64().toBigInt()};break;case 9:r.value={oneofKind:"uint32Val",uint32Val:e.uint32()};break;case 10:r.value={oneofKind:"uint16Val",uint16Val:e.uint32()};break;case 11:r.value={oneofKind:"uint8Val",uint8Val:e.uint32()};break;case 12:r.value={oneofKind:"float64Val",float64Val:e.double()};break;case 13:r.value={oneofKind:"float32Val",float32Val:e.float()};break;case 14:r.value={oneofKind:"float16Val",float16Val:e.float()};break;case 15:r.value={oneofKind:"charVal",charVal:e.uint32()};break;case 16:r.value={oneofKind:"boolVal",boolVal:e.bool()};break;case 17:r.value={oneofKind:"stringVal",stringVal:e.bytes()};break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0!==e.tag&&t.tag(1,h.WireType.Varint).int32(e.tag),"int128Val"===e.value.oneofKind&&v.internalBinaryWrite(e.value.int128Val,t.tag(2,h.WireType.LengthDelimited).fork(),n).join(),"int64Val"===e.value.oneofKind&&t.tag(3,h.WireType.Varint).int64(e.value.int64Val),"int32Val"===e.value.oneofKind&&t.tag(4,h.WireType.Varint).int32(e.value.int32Val),"int16Val"===e.value.oneofKind&&t.tag(5,h.WireType.Varint).int32(e.value.int16Val),"int8Val"===e.value.oneofKind&&t.tag(6,h.WireType.Varint).int32(e.value.int8Val),"uint128Val"===e.value.oneofKind&&_.internalBinaryWrite(e.value.uint128Val,t.tag(7,h.WireType.LengthDelimited).fork(),n).join(),"uint64Val"===e.value.oneofKind&&t.tag(8,h.WireType.Varint).uint64(e.value.uint64Val),"uint32Val"===e.value.oneofKind&&t.tag(9,h.WireType.Varint).uint32(e.value.uint32Val),"uint16Val"===e.value.oneofKind&&t.tag(10,h.WireType.Varint).uint32(e.value.uint16Val),"uint8Val"===e.value.oneofKind&&t.tag(11,h.WireType.Varint).uint32(e.value.uint8Val),"float64Val"===e.value.oneofKind&&t.tag(12,h.WireType.Bit64).double(e.value.float64Val),"float32Val"===e.value.oneofKind&&t.tag(13,h.WireType.Bit32).float(e.value.float32Val),"float16Val"===e.value.oneofKind&&t.tag(14,h.WireType.Bit32).float(e.value.float16Val),"charVal"===e.value.oneofKind&&t.tag(15,h.WireType.Varint).uint32(e.value.charVal),"boolVal"===e.value.oneofKind&&t.tag(16,h.WireType.Varint).bool(e.value.boolVal),"stringVal"===e.value.oneofKind&&t.tag(17,h.WireType.LengthDelimited).bytes(e.value.stringVal);let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const D=new k;class N extends h.MessageType{constructor(){super("relationalai.protocol.ValueType",[{no:1,name:"argument_types",kind:"message",repeat:1,T:()=>U}])}create(e){const t={argumentTypes:[]};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.argumentTypes.push(U.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.argumentTypes.length;a++)U.internalBinaryWrite(e.argumentTypes[a],t.tag(1,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const R=new N;class A extends h.MessageType{constructor(){super("relationalai.protocol.ConstantType",[{no:1,name:"rel_type",kind:"message",T:()=>U},{no:2,name:"value",kind:"message",T:()=>w}])}create(e){const t={};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.relType=U.internalBinaryRead(e,e.uint32(),n,r.relType);break;case 2:r.value=w.internalBinaryRead(e,e.uint32(),n,r.value);break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){e.relType&&U.internalBinaryWrite(e.relType,t.tag(1,h.WireType.LengthDelimited).fork(),n).join(),e.value&&w.internalBinaryWrite(e.value,t.tag(2,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const S=new A;class V extends h.MessageType{constructor(){super("relationalai.protocol.RelType",[{no:1,name:"tag",kind:"enum",T:()=>["relationalai.protocol.Kind",T]},{no:2,name:"primitive_type",kind:"enum",T:()=>["relationalai.protocol.PrimitiveType",f]},{no:3,name:"value_type",kind:"message",T:()=>R},{no:4,name:"constant_type",kind:"message",T:()=>S}])}create(e){const t={tag:0,primitiveType:0};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.tag=e.int32();break;case 2:r.primitiveType=e.int32();break;case 3:r.valueType=R.internalBinaryRead(e,e.uint32(),n,r.valueType);break;case 4:r.constantType=S.internalBinaryRead(e,e.uint32(),n,r.constantType);break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){0!==e.tag&&t.tag(1,h.WireType.Varint).int32(e.tag),0!==e.primitiveType&&t.tag(2,h.WireType.Varint).int32(e.primitiveType),e.valueType&&R.internalBinaryWrite(e.valueType,t.tag(3,h.WireType.LengthDelimited).fork(),n).join(),e.constantType&&S.internalBinaryWrite(e.constantType,t.tag(4,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const U=new V;class C extends h.MessageType{constructor(){super("relationalai.protocol.MetadataInfo",[{no:1,name:"relations",kind:"message",repeat:1,T:()=>L}])}create(e){const t={relations:[]};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();if(1===t)r.relations.push(L.internalBinaryRead(e,e.uint32(),n));else{let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){for(let a=0;a<e.relations.length;a++)L.internalBinaryWrite(e.relations[a],t.tag(1,h.WireType.LengthDelimited).fork(),n).join();let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const O=new C;class P extends h.MessageType{constructor(){super("relationalai.protocol.RelationMetadata",[{no:1,name:"relation_id",kind:"message",T:()=>g},{no:2,name:"file_name",kind:"scalar",T:9}])}create(e){const t={fileName:""};return globalThis.Object.defineProperty(t,h.MESSAGE_TYPE,{enumerable:!1,value:this}),void 0!==e&&(0,h.reflectionMergePartial)(this,t,e),t}internalBinaryRead(e,t,n,a){let r=a??this.create(),i=e.pos+t;for(;e.pos<i;){let[t,a]=e.tag();switch(t){case 1:r.relationId=g.internalBinaryRead(e,e.uint32(),n,r.relationId);break;case 2:r.fileName=e.string();break;default:let i=n.readUnknownField;if("throw"===i)throw new globalThis.Error(`Unknown field ${t} (wire type ${a}) for ${this.typeName}`);let s=e.skip(a);!1!==i&&(!0===i?h.UnknownFieldHandler.onRead:i)(this.typeName,r,t,a,s)}}return r}internalBinaryWrite(e,t,n){e.relationId&&g.internalBinaryWrite(e.relationId,t.tag(1,h.WireType.LengthDelimited).fork(),n).join(),""!==e.fileName&&t.tag(2,h.WireType.LengthDelimited).string(e.fileName);let a=n.writeUnknownFields;return!1!==a&&(1==a?h.UnknownFieldHandler.onWrite:a)(this.typeName,e,t),t}}const L=new P;var $,M,F,W;async function B(e){const t=[];for(const n of e)if("string"!=typeof n.file&&"application/vnd.apache.arrow.stream"===n.file.type){const e=await(0,y.tableFromIPC)(n.file.stream());t.push({relationId:n.name,filename:n.file.name,table:e})}return t}async function x(e,t){const n=(t?.relations||[]).reduce(((e,t)=>(e[t.fileName]=t.relationId,e)),{});return e.map((e=>{const t=n[e.filename]||{arguments:[]};return{relationId:e.relationId,table:e.table,metadata:t}}))}async function j(e){if(!e?.arrayBuffer)throw new Error("Unsupported metadata type: "+typeof e);try{const t=await e.arrayBuffer(),n=new Uint8Array(t);return O.fromBinary(n)}catch(e){if("illegal tag: field no 0 wire type 0"===e.message)return{relations:[]};throw e}}async function K(e){let t;if("string"==typeof e)t=e;else{const n=await e.arrayBuffer();t=(new TextDecoder).decode(n)}return JSON.parse(t)}!function(e){e.OPEN="OPEN",e.CREATE="CREATE",e.CREATE_OVERWRITE="CREATE_OVERWRITE",e.OPEN_OR_CREATE="OPEN_OR_CREATE",e.CLONE="CLONE",e.CLONE_OVERWRITE="CLONE_OVERWRITE"}($||($={})),function(e){e.CREATED="CREATED",e.RUNNING="RUNNING",e.CANCELLING="CANCELLING",e.ABORTED="ABORTED",e.COMPLETED="COMPLETED"}(M||(M={}));class H extends d{async runTransaction(e,t,n,a=$.OPEN){const r={dbname:e,compute_name:t,open_mode:a,region:this.region};return await this.post("transaction",{query:r,body:n})}async runActions(e,t,n,a=!0){const r=n.map(((e,t)=>function(e,t){return{type:"LabeledAction",name:e,action:t}}(`action-${t}`,e))),i={type:"Transaction",abort:!1,dbname:e,mode:$.OPEN,nowait_durable:!1,readonly:a,version:0,actions:r,computeName:t};return await this.runTransaction(e,t,i)}}!function(e){e.XS="XS",e.S="S",e.M="M",e.L="L",e.XL="XL"}(F||(F={})),function(e){e.REQUESTED="REQUESTED",e.PROVISIONING="PROVISIONING",e.REGISTERING="REGISTERING",e.PROVISIONED="PROVISIONED",e.PROVISION_FAILED="PROVISION_FAILED",e.DELETE_REQUESTED="DELETE_REQUESTED",e.STOPPING="STOPPING",e.DELETING="DELETING",e.DELETED="DELETED",e.DELETION_FAILED="DELETION_FAILED"}(W||(W={}));const G="compute",Y="oauth-clients",q="transactions";class J extends d{async runTransactionAsync(e){const t=await this.post(q,{body:e});return Array.isArray(t)?await async function(e){const t=e.find((e=>"transaction"===e.name)),n=e.find((e=>"problems"===e.name)),a=e.find((e=>"metadata.proto"===e.name));if(!t)throw new Error("transaction part not found");const r=a?await j(a.file):void 0,i={transaction:await K(t.file),results:await x(await B(e),r)};return n&&(i.problems=await K(n.file)),i}(t):{transaction:t}}async listTransactions(e){return(await this.get(q,e)).transactions}async getTransaction(e){return(await this.get(`transactions/${e}`)).transaction}async getTransactionResults(e){const t=await this.get(`transactions/${e}/results`);return await B(t)}async getTransactionMetadata(e){return j(await this.request(`transactions/${e}/metadata`,{method:"GET",headers:{Accept:"application/x-protobuf"}}))}async getTransactionProblems(e){return await this.get(`transactions/${e}/problems`)}async cancelTransaction(e){return await this.post(`transactions/${e}/cancel`,{})||{}}}function z(e,t,n=e){return{type:"Source",name:e,value:t,path:n}}const Q=(e,t)=>({rel_key:{values:[],name:e,keys:["RAI_VariableSizeStrings.VariableSizeString"],type:"RelKey"},type:"Relation",columns:[[t]]});function X(e){return"string"==typeof e?1===e.length?`'${e.replace(/'/g,"\\'")}'`:`"${e.replace(/"/g,'\\"')}"`:"number"==typeof e?e:"boolean"==typeof e?e?"true":"false":void 0}var Z,ee;!function(e){e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE"}(Z||(Z={})),function(e){e.USER="user",e.ADMIN="admin"}(ee||(ee={}));const te="users";class ne extends d{}var ae;ae=ne,[class extends d{async createDatabase(e,t){return(await this.put(p,{body:{name:e,source_name:t}})).database}async listDatabases(e){return(await this.get(p,e)).databases}async getDatabase(e){return(await this.listDatabases({name:e}))[0]}async deleteDatabase(e){return await this.delete(p,{body:{name:e}})}},class extends H{async listEdbs(e,t){const n=await this.runActions(e,t,[{type:"ListEdbAction"}]);if("ListEdbActionResult"===n.actions[0]?.result?.type)return n.actions[0].result.rels;throw new Error("ListEdbActionResult is missing")}async deleteEdb(e,t,n){const a={type:"ModifyWorkspaceAction",delete_edb:n},r=await this.runActions(e,t,[a],!1);if("ModifyWorkspaceActionResult"===r.actions[0]?.result?.type)return r.actions[0].result.delete_edb_result;throw new Error("ModifyWorkspaceActionResult is missing")}},class extends d{async createEngine(e,t=F.XS){return(await this.put(G,{body:{region:this.region,name:e,size:t}})).compute}async listEngines(e){return(await this.get(G,e)).computes}async getEngine(e){return(await this.listEngines({name:e}))[0]}async deleteEngine(e){return(await this.delete(G,{body:{name:e}})).status}},class extends H{async installModels(e,t,n){const a={type:"InstallAction",sources:n};return await this.runActions(e,t,[a],!1)}async listModels(e,t){return await this.runActions(e,t,[{type:"ListSourceAction"}])}async getModel(e,t,n){const a=await this.listModels(e,t);if("ListSourceActionResult"===a.actions[0]?.result?.type){const e=a.actions[0].result.sources.find((e=>e.name===n));if(e)return e}throw new Error(`Model '${n}' not found`)}async deleteModel(e,t,n){const a={type:"ModifyWorkspaceAction",delete_source:[n]},r=await this.runActions(e,t,[a],!1);if("ModifyWorkspaceActionResult"===r.actions[0]?.result?.type)return r.actions[0].result;throw new Error("ModifyWorkspaceActionResult is missing")}},class extends d{async createOAuthClient(e,t){return(await this.post(Y,{body:{name:e,permissions:t}})).client}async listOAuthClients(){return(await this.get(Y)).clients}async getOAuthClient(e){return(await this.get(`oauth-clients/${e}`)).client}async updateOAuthClient(e,t,n){const a={};return t&&(a.name=t),n&&(a.permissions=n),(await this.patch(`oauth-clients/${e}`,{body:a})).client}async rotateOAuthClientSecret(e){return(await this.post(`oauth-clients/${e}/rotate-secret`,{})).client}async deleteOAuthClient(e){return await this.delete(`oauth-clients/${e}`,{})}async listPermissions(){return(await this.get("permissions",{})).permissions}},class extends J{async execAsync(e,t,n,a=[],r=!0,i=[]){const s={dbname:e,query:n,nowait_durable:!1,readonly:r,v1_inputs:a.map((e=>Q(e.name,e.value))),tags:i};return t&&(s.engine_name=t),await this.runTransactionAsync(s)}async exec(e,t,n,a=[],r=!0,i=[],s=1e3,o=Number.POSITIVE_INFINITY){const l=await this.execAsync(e,t,n,a,r,i),c=l.transaction.id;return"results"in l?l:await this.pollTransaction(c,s,o)}async pollTransaction(e,t=1e3,n=Number.POSITIVE_INFINITY){const a=Date.now();let r;await new Promise(((i,s)=>{const o=()=>{setTimeout((async()=>{var t;r=await this.getTransaction(e),(t=r.state)===M.ABORTED||t===M.COMPLETED?i():(Date.now()-a>n&&s(new Error(`Polling transaction timeout of ${n}ms has been exceeded.`)),o())}),t)};o()}));const i=await Promise.all([this.getTransactionMetadata(e),this.getTransactionProblems(e),this.getTransactionResults(e)]),s=await x(i[2],i[0]);return{transaction:r,problems:i[1],results:s}}},class extends H{async query(e,t,n,a=[],r=!0){const i=function(e,t=[]){return{type:"QueryAction",outputs:[],persist:[],source:z("query",e,""),inputs:t.map((e=>Q(e.name,e.value)))}}(n,a);return await this.runActions(e,t,[i],r)}async loadJson(e,t,n,a){const r=["def config:data = data",`def insert:${n} = load_json[config]`],i=[{name:"data",value:JSON.stringify(a)}];return this.query(e,t,r.join("\n"),i,!1)}async loadCsv(e,t,n,a,r,i){const s=["def config:data = data"],o=[{name:"data",value:a}];return r&&s.push(...function(e){const t=[];return Object.keys(e).forEach((n=>{const a=n;if("header"===a){const n=Object.keys(e.header).map((t=>`(${t}, ${X(e.header[t])})`)).join("; ");t.push(`def config:syntax:header = ${n}`)}else t.push(`def config:syntax:${a} = ${X(e[a])}`)})),t}(r)),i&&s.push(...function(e){const t=[];return Object.keys(e).forEach((n=>{t.push(`def config:schema${n} = ${X(e[n])}`)})),t}(i)),s.push(`def insert:${n} = load_csv[config]`),this.query(e,t,s.join("\n"),o,!1)}},H,J,class extends d{async createUser(e,t){return(await this.post(te,{body:{email:e,roles:t}})).user}async listUsers(){return(await this.get(te)).users}async getUser(e){return(await this.get(`users/${e}`)).user}async updateUser(e,t,n){const a={};return t&&(a.status=t),n&&n.length&&(a.roles=n),(await this.patch(`users/${e}`,{body:a})).user}async enableUser(e){return await this.updateUser(e,Z.ACTIVE)}async disableUser(e){return await this.updateUser(e,Z.INACTIVE)}async deleteUser(e){return await this.delete(`users/${e}`,{})}}].forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((t=>{Object.defineProperty(ae.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))}))}));const re=ne;var ie,se;!function(e){e.CREATED="CREATED",e.CREATING="CREATING",e.CREATION_FAILED="CREATION_FAILED",e.DELETED="DELETED"}(ie||(ie={})),function(e){e.CREATE_COMPUTE="create:compute",e.DELETE_COMPUTE="delete:compute",e.LIST_COMPUTES="list:compute",e.READ_COMPUTE="read:compute",e.CREATE_DATABASE="create:database",e.LIST_DATABASES="list:database",e.UPDATE_DATABASE="update:database",e.DELETE_DATABASE="delete:database",e.RUN_TRANSACTION="run:transaction",e.LIST_TRANSACTION="list:transaction",e.DELETE_TRANSACTION="delete:transaction",e.READ_TRANSACTION="read:transaction",e.READ_CREDITS_USAGE="read:credits_usage",e.CREATE_OAUTH_CLIENT="create:oauth_client",e.READ_OAUTH_CLIENT="read:oauth_client",e.LIST_OAUTH_CLIENTS="list:oauth_client",e.UPDATE_OAUTH_CLIENT="update:oauth_client",e.DELETE_OAUTH_CLIENT="delete:oauth_client",e.ROTATE_OAUTH_CLIENT_SECRET="rotate:oauth_client_secret",e.CREATE_USER="create:user",e.LIST_USERS="list:user",e.READ_USER="read:user",e.UPDATE_USER="update:user",e.DELETE_USER="delete:user",e.LIST_ROLES="list:role",e.READ_ROLE="read:role",e.LIST_PERMISSIONS="list:permission",e.CREATE_ACCESS_KEY="create:accesskey",e.LIST_ACCESS_KEYS="list:accesskey"}(se||(se={}));class oe{}class le extends oe{getToken;constructor(e){super(),this.getToken=e}}class ce{token;experiesIn;createdOn;constructor(e,t,n){this.token=e,this.experiesIn=t,this.createdOn=n}get isExpired(){return(Date.now()-this.createdOn)/1e3>=this.experiesIn}}class ue extends oe{readCache;writeCache;clientId;clientSecret;clientCredentialsUrl;accessToken;constructor(e,t,n,a,r){super(),this.readCache=a,this.writeCache=r,this.clientId=e,this.clientSecret=t,this.clientCredentialsUrl=n}async getToken(e){return await this.readTokenFromCache(),this.accessToken&&!this.accessToken.isExpired?this.accessToken.token:this.requestToken(e)}async readTokenFromCache(){if(!this.accessToken&&this.readCache){const e=await this.readCache();e&&(this.accessToken=new ce(e.access_token,e.expires_in,e.created_on))}}async requestToken(e){const t=new URL(e),n={client_id:this.clientId,client_secret:this.clientSecret,grant_type:"client_credentials",audience:`https://${t.hostname}`},a=await u(this.clientCredentialsUrl,{method:"POST",body:n}),r={access_token:a.access_token,expires_in:a.expires_in,created_on:Date.now()};return this.accessToken=new ce(r.access_token,r.expires_in,r.created_on),this.writeCache&&await this.writeCache(r),this.accessToken.token}}const de=require("console-table-printer"),pe=require("decimal.js");var ye=e.n(pe);ye().config({precision:31});const he=621356832e5,fe=/^Int(\d+)$/,Te=/^UInt(\d+)$/,me=/^Float(\d+)$/,ge=/^FixedPointDecimals.FixedDecimal{Int(\d+), (\d+)}$/,Ee=/^Rational{Int(\d+)}$/;function we(e){if(e.startsWith(":"))return{type:"Constant",name:"Symbol",value:{type:"String",value:e}};if(e.includes("(")&&!e.startsWith("("))return{type:"Constant",name:e,value:{type:"String",value:e}};if("String"===e)return{type:"String"};if("Bool"===e)return{type:"Bool"};if("Char"===e)return{type:"Char"};if("Dates.DateTime"===e)return{type:"DateTime"};if("Dates.Date"===e)return{type:"Date"};if("Dates.Year"===e)return{type:"Year"};if("Dates.Month"===e)return{type:"Month"};if("Dates.Week"===e)return{type:"Week"};if("Dates.Day"===e)return{type:"Day"};if("Dates.Hour"===e)return{type:"Hour"};if("Dates.Minute"===e)return{type:"Minute"};if("Dates.Second"===e)return{type:"Second"};if("Dates.Millisecond"===e)return{type:"Millisecond"};if("Dates.Microsecond"===e)return{type:"Microsecond"};if("Dates.Nanosecond"===e)return{type:"Nanosecond"};if("HashValue"===e)return{type:"Hash"};if("Missing"===e)return{type:"Missing"};if("FilePos"===e)return{type:"FilePos"};const t=e.match(fe);if(t&&2===t.length)return{type:`Int${t[1]}`};const n=e.match(Te);if(n&&2===n.length)return{type:`UInt${n[1]}`};const a=e.match(me);if(a&&2===a.length)return{type:`Float${a[1]}`};const r=e.match(ge);if(r&&3===r.length)return{type:`Decimal${Number.parseInt(r[1])}`,places:Number.parseInt(r[2])};const i=e.match(Ee);return i&&2===i.length?{type:`Rational${i[1]}`}:{type:"Unknown",name:e}}function Ie(e){if(e.tag===T.CONSTANT_TYPE&&e.constantType?.value&&e.constantType?.relType){const t=Ie(e.constantType.relType);if("ValueType"!==t.type){const n=e.constantType.value.arguments.map(ke),a=ve(t,1===n.length?n[0]:n);return{type:"Constant",name:"String"===t.type?"Symbol":`${t.type}(${be(t,a)})`,value:{...t,value:a}}}{const n=De(t,e.constantType.value.arguments);return{type:"Constant",name:`${t.type}(${be(t,n)})`,value:{...t,value:ve(t,n)}}}}if(e.tag===T.PRIMITIVE_TYPE)switch(e.primitiveType){case f.SYMBOL:case f.STRING:return{type:"String"};case f.CHAR:return{type:"Char"};case f.BOOL:return{type:"Bool"};case f.INT_8:return{type:"Int8"};case f.INT_16:return{type:"Int16"};case f.INT_32:return{type:"Int32"};case f.INT_64:return{type:"Int64"};case f.INT_128:return{type:"Int128"};case f.UINT_8:return{type:"UInt8"};case f.UINT_16:return{type:"UInt16"};case f.UINT_32:return{type:"UInt32"};case f.UINT_64:return{type:"UInt64"};case f.UINT_128:return{type:"UInt128"};case f.FLOAT_16:return{type:"Float16"};case f.FLOAT_32:return{type:"Float32"};case f.FLOAT_64:return{type:"Float64"}}return e.tag===T.VALUE_TYPE&&e.valueType?function(e){const t=e.typeDefs.slice(0,3).filter((e=>"Constant"===e.type&&"String"===e.value.type));if(3!==t.length||":rel"!==t[0].value.value||":base"!==t[1].value.value)return e;const n=t[2].value.value.slice(1);switch(n){case"DateTime":case"Date":case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"FilePos":case"Missing":case"Hash":return{type:n};case"FixedDecimal":if(6===e.typeDefs.length&&"Constant"===e.typeDefs[3].type&&"Constant"===e.typeDefs[4].type){const t=Number(e.typeDefs[3].value.value),n=Number(e.typeDefs[4].value.value);if(16===t||32===t||64===t||128===t)return{type:`Decimal${t}`,places:n}}break;case"Rational":if(4===e.typeDefs.length&&"ValueType"===e.typeDefs[3].type){const t=e.typeDefs[3];if(2===t.typeDefs.length)switch(t.typeDefs[0].type){case"Int8":return{type:"Rational8"};case"Int16":return{type:"Rational16"};case"Int32":return{type:"Rational32"};case"Int64":return{type:"Rational64"};case"Int128":return{type:"Rational128"}}}}return e}({type:"ValueType",typeDefs:e.valueType.argumentTypes.map((e=>Ie(e)))}):{type:"Unknown"}}function ve(e,t){switch(e.type){case"String":case"Bool":case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"FilePos":case"Int8":case"Int16":case"Int32":case"Int64":case"UInt8":case"UInt16":case"UInt32":case"UInt64":case"Float16":case"Float32":case"Float64":return t;case"Char":return String.fromCodePoint(t);case"DateTime":return new Date(Number(t)-he);case"Date":return new Date(864e5*Number(t)-he);case"Missing":return null;case"Hash":case"UInt128":return n=Array.from(t),BigInt.asUintN(64,n[1])<<BigInt(64)|n[0];case"Int128":return _e(Array.from(t));case"Decimal16":case"Decimal32":case"Decimal64":return new(ye())(t.toString()).dividedBy(Math.pow(10,e.places));case"Decimal128":{const n=_e(Array.from(t));return new(ye())(n.toString()).dividedBy(Math.pow(10,e.places))}case"Rational8":case"Rational16":case"Rational32":case"Rational64":return{numerator:(t=Array.from(t))[0],denominator:t[1]};case"Rational128":return t=Array.from(t),{numerator:_e(Array.from(t[0])),denominator:_e(Array.from(t[1]))};case"Constant":return e.value.value;case"ValueType":{const n=e.typeDefs.filter((e=>"Constant"!==e.type));let a=t?.toArray?t.toArray():t;return 1===n.length&&(a=[a]),n.map(((e,t)=>ve(e,a[t])))}case"Unknown":return t&&t.toJSON?t.toJSON():t}var n}function be(e,t){const n={...e,value:t};if("Constant"===e.type)return be(e.value,t);switch(n.type){case"String":return JSON.stringify(n.value).slice(1,-1);case"Bool":return n.value?"true":"false";case"Char":return n.value;case"DateTime":return n.value.toISOString();case"Date":return n.value.toISOString().split("T")[0];case"Year":case"Month":case"Week":case"Day":case"Hour":case"Minute":case"Second":case"Millisecond":case"Microsecond":case"Nanosecond":case"Int8":case"Int16":case"Int32":case"Int64":case"Int128":case"UInt8":case"UInt16":case"UInt32":case"UInt64":case"UInt128":case"FilePos":case"Hash":return n.value.toString();case"Missing":return"missing";case"Float16":case"Float32":case"Float64":return n.value%1==0?n.value+".0":n.value.toString();case"Decimal16":case"Decimal32":case"Decimal64":case"Decimal128":return n.value.toFixed(n.places);case"Rational8":case"Rational16":case"Rational32":case"Rational64":case"Rational128":return`${n.value.numerator}/${n.value.denominator}`;case"ValueType":return n.typeDefs.filter((e=>"Constant"!==e.type)).map(((e,t)=>{const a=be(e,n.value[t]);return"ValueType"===e.type?`(${a})`:a})).join(", ");case"Unknown":{const e=n.value;return"object"==typeof e?Object.keys(e).map((t=>`${e[t]}`)).join(", "):e}}}function _e(e){return BigInt.asIntN(64,e[1])<<BigInt(64)|e[0]}function ke(e){switch(e.value.oneofKind){case"stringVal":return`:${(new TextDecoder).decode(e.value.stringVal)}`;case"charVal":return e.value.charVal;case"boolVal":return e.value.boolVal;case"int8Val":return e.value.int8Val;case"int16Val":return e.value.int16Val;case"int32Val":return e.value.int32Val;case"int64Val":return e.value.int64Val;case"int128Val":return[e.value.int128Val.lowbits,e.value.int128Val.highbits];case"uint8Val":return e.value.uint8Val;case"uint16Val":return e.value.uint16Val;case"uint32Val":return e.value.uint32Val;case"uint64Val":return e.value.uint64Val;case"uint128Val":return[e.value.uint128Val.lowbits,e.value.uint128Val.highbits];case"float16Val":return e.value.float16Val;case"float32Val":return e.value.float32Val;case"float64Val":return e.value.float64Val}throw new Error("Unknown primitive value")}function De(e,t){const n=t.map(ke),a=[],r=(e,t)=>{if("ValueType"===e.type){const n=[];t.push(n),e.typeDefs.forEach((e=>r(e,n)))}else"Constant"!==e.type&&t.push(n.splice(0,1)[0])};return r(e,a),a[0]}class Ne{relation;table;colDefs;constructor(e){this.relation=e,this.table=e.table;const t=e.metadata.arguments.filter((e=>e.tag!==T.UNSPECIFIED_KIND)).length?e.metadata.arguments:e.relationId.split("/").filter((e=>e));let n=0;this.colDefs=t.map((e=>{const t="string"==typeof e?we(e):Ie(e),a={typeDef:t,metadata:"object"==typeof e?e:{tag:T.UNSPECIFIED_KIND,primitiveType:f.UNSPECIFIED_TYPE}};return"Constant"!==t.type&&(a.arrowIndex=n,n++),a}))}typeDefs(){return this.colDefs.map((e=>e.typeDef))}get columnLength(){return this.colDefs.length}columns(){const e=[];for(let t=0;t<this.columnLength;t++)e.push(this.columnAt(t));return e}columnAt(e){const t=this.colDefs[e];if(!t)throw new Error("Couldn't find column by index");const n=this.table,a=Ae(this.colDefs)?1:this.table.numRows,r={get length(){return a},get typeDef(){return t.typeDef},*[Symbol.iterator](){if("Constant"===t.typeDef.type)for(let e=0;e<a;e++)yield ve(t.typeDef,null);else{const e=n.getChildAt(t.arrowIndex);if(!e)throw new Error("Couldn't find column by index");for(const n of e)yield ve(t.typeDef,n)}},values(){return Array.from(this)},get(e){if(!(e<0||e>=a)){if("Constant"===t.typeDef.type)return ve(t.typeDef,null);{const a=n.getChildAt(t.arrowIndex);return ve(t.typeDef,a.get(e))}}}};return r}sliceColumns(e,t){const n=this.colDefs.slice(e,t),a=[];n.forEach((e=>{void 0!==e.arrowIndex&&a.push(this.table.schema.names[e.arrowIndex])}));const r=this.relation.relationId.split("/").filter((e=>e)).slice(e,t).join("/"),i=this.table.select(a);return new Ne({relationId:`/${r}`,table:i,metadata:{arguments:n.map((e=>e.metadata))}})}get length(){return Ae(this.colDefs)?1:this.table.numRows}*[Symbol.iterator](){Ae(this.colDefs)&&(yield this.get(0));for(const e of this.table)yield Re(e,this.colDefs)}values(){return Array.from(this)}get(e){if(Ae(this.colDefs)&&0===e)return this.colDefs.map((e=>ve(e.typeDef,null)));const t=this.table.get(e);return t?Re(t,this.colDefs):void 0}slice(e,t){const n=this.table.slice(e,t);return new Ne({relationId:this.relation.relationId,table:n,metadata:this.relation.metadata})}print(){const e=new de.Table({columns:this.colDefs.map(((e,t)=>({name:t.toString(),title:e.typeDef.name||e.typeDef.type})))});this.values().forEach((t=>{const n={};t.forEach(((e,t)=>{const{typeDef:a}=this.colDefs[t];n[t]=be(a,e)})),e.addRow(n)})),e.printTable()}physical(){const e=this.relation.relationId.split("/").filter((e=>e.length&&"Constant"!==we(e).type)).join("/");return new Ne({relationId:`/${e}`,table:this.table,metadata:{arguments:this.colDefs.filter((e=>"Constant"!==e.typeDef.type)).map((e=>e.metadata))}})}arrow(){return this.table}}function Re(e,t){const n=e.toArray();return t.map((e=>"Constant"===e.typeDef.type?ve(e.typeDef,null):ve(e.typeDef,n[e.arrowIndex])))}function Ae(e){return e.length&&e.every((e=>"Constant"===e.typeDef.type))}const Se=require("config-ini-parser"),Ve=require("fs"),Ue=require("os"),{readFile:Ce,writeFile:Oe}=Ve.promises;async function Pe(e="default",t="~/.rai/config"){t=Fe(t);try{const n=await Ce(t,"utf-8"),a=new Se.ConfigIniParser;if(a.parse(n),!a.isHaveSection(e))throw new Error(`Profile '${e}' not found in ${t}`);return function(e,t){for(const n of Le)if(!e.get(t,n,""))throw new Error(`Can't find ${n} field in ${t} profile`);return{host:e.get(t,"host",""),port:e.get(t,"port","443"),scheme:e.get(t,"scheme",$e),credentials:new ue(e.get(t,"client_id",""),e.get(t,"client_secret",""),e.get(t,"client_credentials_url",Me),(async()=>await async function(e="default"){const t=We(e);try{const e=await Ce(t,"utf-8"),n=JSON.parse(e);if(n.access_token&&n.created_on&&n.expires_in)return n}catch{}}(t)),(async e=>await async function(e,t="default"){const n=We(t),a=JSON.stringify(e,null,2);await Oe(n,a,"utf-8")}(e,t)))}}(a,e)}catch(e){throw function(e){return e instanceof Error}(e)&&"ENOENT"===e.code?new Error(`Can't find file: ${t}`):e}}const Le=["host","client_id","client_secret"],$e="https",Me="https://login.relationalai.com/oauth/token";function Fe(e){return e.startsWith("~/")?`${(0,Ue.homedir)()}/${e.slice(2)}`:e}function We(e){return Fe(`~/.rai/${e}_cache.json`)}var Be=exports;for(var xe in t)Be[xe]=t[xe];t.__esModule&&Object.defineProperty(Be,"__esModule",{value:!0})})();
//# sourceMappingURL=rai-sdk-javascript.cjs.map